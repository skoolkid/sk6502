<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Bugs</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Bugs">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Bugs</td>
</tr>
</table>
<ul class="contents">
<li><a href="#mistrialSubtraction">Mistrial subtraction</a></li>
<li><a href="#lowProductValues">Low product values</a></li>
<li><a href="#derelictionOfDinnerDuty">Dereliction of dinner duty</a></li>
<li><a href="#pairOfJerks">A pair of jerks</a></li>
<li><a href="#bullyAndBlackboard">The bully and the blackboard</a></li>
<li><a href="#theWallMostStaredAt">The wall most stared at</a></li>
<li><a href="#hiddenAccusers">Hidden accusers</a></li>
<li><a href="#aStepTooFar">A step too far</a></li>
<li><a href="#doubleStaircases">Double staircases</a></li>
<li><a href="#staircaseSaga">The staircase saga continues</a></li>
<li><a href="#initialNonPlaytimes">Initial non-playtimes</a></li>
<li><a href="#invisibilityRange">Invisibility range</a></li>
<li><a href="#creaksSuperiorVision">MR CREAK's superior vision</a></li>
<li><a href="#offByOne">Off by one</a></li>
<li><a href="#disappearingPellet">The disappearing pellet</a></li>
<li><a href="#leapsOfFaith">Leaps of faith</a></li>
<li><a href="#misplacedMessageBox">Misplaced message box</a></li>
<li><a href="#brokenBookcase">Broken bookcase</a></li>
<li><a href="#missAndHit">Miss and hit</a></li>
<li><a href="#allPlayAndNoWork">All play and no work</a></li>
<li><a href="#waitingForEinstein">Waiting for EINSTEIN</a></li>
<li><a href="#wackersNumberBlindness">WACKER's number blindness</a></li>
<li><a href="#rockittExamRoom">MR ROCKITT as a boy</a></li>
<li><a href="#typo">Misspelt element</a></li>
<li><a href="#emptyClass">MR CREAK and the empty class</a></li>
<li><a href="#chairHit">Share a chair</a></li>
<li><a href="#absentTearaway">800 LINES BOY WONDER - NOW WHERE ARE YOU?</a></li>
</ul>
<div><span id="mistrialSubtraction"></span></div>
<div class="box box-1">
<div class="box-title">Mistrial subtraction</div>
<div class="paragraph">
The routine at <a href="../asm/217E.html">$217E</a> miscalculates the 10000s digit of a number. Instead of
repeatedly trying to subtract 10000 to determine the digit, it subtracts 10100
(and then checks whether the result is still 10100 or greater).
</div>
<div class="paragraph">
<div>POKE 8613,16 <a href="../asm/217E.html#21A1">($21A5,$10)</a></div>
<div>POKE 8637,16 <a href="../asm/217E.html#21BC">($21BD,$10)</a></div>
</div>
</div>
<div><span id="lowProductValues"></span></div>
<div class="box box-2">
<div class="box-title">Low product values</div>
<div class="paragraph">
The numbers that MR WACKER asks the class to multiply are supposed to be
between 32 and 99 (to ensure that the answer has exactly 4 digits), but because
of a bug in the routine at <a href="../asm/253E.html">$253E</a>, the numbers are actually between 0 and 67.
</div>
</div>
<div><span id="derelictionOfDinnerDuty"></span></div>
<div class="box box-1">
<div class="box-title">Dereliction of dinner duty</div>
<div class="paragraph">
During dinner, the teacher on duty is supposed to walk up and down between the
table (at x-coordinate 54) and the middle of the bench (at x-coordinate 42) in
the dinner hall for a while before dinner actually starts. However, the x- and
y-coordinates of that second location are the wrong way round in command list
<a href="../asm/423B.html">$B8</a>, which means the teacher instead walks up and down between the
table in the dinner hall and the bottom of the staircase (at x-coordinate 17)
that leads up to the staff room.
</div>
<div class="paragraph">
POKE 16961,42 <a href="../asm/423B.html#4241">($4241,$2A)</a>
</div>
</div>
<div><span id="pairOfJerks"></span></div>
<div class="box box-2">
<div class="box-title">A pair of jerks</div>
<div class="paragraph">
BOY WONDER often takes a step back just before firing his catapult, which
results in his animation appearing somewhat jerky. Likewise, ANGELFACE also
often steps back just before throwing a punch, making his animation appear
somewhat jerky too.
</div>
<div class="paragraph">
The reason for this is that the continual subcommand routines that make BOY
WONDER fire occasionally (<a href="../asm/2CA5.html">$2CA5</a>) and ANGELFACE hit occasionally (<a href="../asm/270D.html">$270D</a>) do
not drop the return address from the stack after deciding to go ahead with the
fire/hit action. This means that they return to the middle of the
character-handling routine at <a href="../asm/3B5E.html">$3B5E</a>, which then has the opportunity of moving
them midstride before they begin the fire/hit action on the next pass through
that routine.
</div>
<div class="paragraph">
The jerky animation can be fixed by reversing the midstride check in the
routines at <a href="../asm/270D.html">$270D</a> and <a href="../asm/2CA5.html">$2CA5</a>:
</div>
<div class="paragraph">
<div>POKE 10000,144 <a href="../asm/270D.html#2710">($2710,$90)</a> (ANGELFACE)</div>
<div>POKE 11438,144 <a href="../asm/2CA5.html#2CAE">($2CAE,$90)</a> (BOY WONDER)</div>
</div>
</div>
<div><span id="bullyAndBlackboard"></span></div>
<div class="box box-1">
<div class="box-title">The bully and the blackboard</div>
<div class="paragraph">
If a teacher gives lines to ERIC for jumping, hitting or firing his catapult
while EINSTEIN is blaming either ERIC or BOY WONDER for writing on the
blackboard, the same teacher will then go on to give lines to ANGELFACE for
writing on the blackboard.
</div>
<div class="paragraph">
Why is the bully unfairly punished for this misdemeanour? It boils down to a
careless use of temporary variables in page 0. The routine at <a href="../asm/0A58.html">$0A58</a> stores
the character number of the boy that EINSTEIN will blame for writing on the
blackboard at <a href="../asm/00C0.html">$C0</a>, then makes EINSTEIN blame that boy, and finally picks up
the character number of the blamed boy from <a href="../asm/00C0.html">$C0</a> and passes it to the routine
at <a href="../asm/2552.html">$2552</a> to decide who should get lines.
</div>
<div class="paragraph">
Now, if the teacher spots ERIC jumping, hitting or firing while EINSTEIN is
blaming ERIC or BOY WONDER for writing on the blackboard, the routine at
<a href="../asm/191B.html">$191B</a> uses <a href="../asm/00C0.html">$C0</a> to temporarily store the character number of the teacher,
thus overwriting the character number of the boy EINSTEIN is telling tales on.
</div>
<div class="paragraph">
All this means that by the time the routine at <a href="../asm/1DB7.html">$1DB7</a> is invoked to give
someone lines for writing on the blackboard, it defaults to giving ANGELFACE
lines because it doesn't recognise the teacher's character number at <a href="../asm/00C0.html">$C0</a> (see
the section of code at <a href="../asm/1DB7.html#1DFC">$1DFC</a>).
</div>
<div class="paragraph">
To make the routine at <a href="../asm/191B.html">$191B</a> use <a href="../asm/00C3.html">$C3</a> instead of <a href="../asm/00C0.html">$C0</a> for storing the
teacher's character number:
</div>
<div class="paragraph">
<div>POKE 6522,195 <a href="../asm/191B.html#1979">($197A,$C3)</a></div>
<div>POKE 6531,195 <a href="../asm/191B.html#1982">($1983,$C3)</a></div>
</div>
</div>
<div><span id="theWallMostStaredAt"></span></div>
<div class="box box-2">
<div class="box-title">The wall most stared at</div>
<div class="paragraph">
When a teacher is in the Map Room, he faces the wall instead of the class while
speaking. This is because command list <a href="../asm/4080.html">$80</a> sends the teacher up to the
map, but does not turn him round before starting the class.
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="wmsa" src="../images/udgs/wmsa.png" /></td>
</tr>
</table>
</div>
</div>
<div><span id="hiddenAccusers"></span></div>
<div class="box box-1">
<div class="box-title">Hidden accusers</div>
<div class="paragraph">
Occasionally during gameplay you might hear something like a truncated sound
effect, and perhaps even also see ERIC's lines total increase at the same time
for no apparent reason.
</div>
<div class="paragraph">
One likely explanation for this phenomenon is that a teacher is giving lines
while off screen. The reason that can happen is that the routine at <a href="../asm/1DB7.html">$1DB7</a>
does not check whether the teacher is on screen before adding lines to ERIC's
total or starting the lines-giving sound effect. But then, when it calls the
routine at <a href="../asm/2043.html">$2043</a> to display the lines message box above the teacher's head,
that routine <em>does</em> check whether the teacher is on screen and returns
early (without displaying the lines message box or pausing to give the
accompanying sound effect time to play) if he isn't.
</div>
</div>
<div><span id="aStepTooFar"></span></div>
<div class="box box-2">
<div class="box-title">A step too far</div>
<div class="paragraph">
If a teacher is going to teach a class in the Exam Room, he faces the wrong way
at the doorway when telling the kids to sit down.
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="stf" src="../images/udgs/stf.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
The reason for this behaviour is that the x-coordinate of the top of the
staircase is defined, in the fifth entry of the table at <a href="../asm/4454.html">$4454</a>, as 76. This
means that when the teacher has reached the bottom of the staircase, his
x-coordinate is 69, which is one to the left of the x-coordinate of the Exam
Room doorway at 70, as defined in command list <a href="../asm/40AE.html">$84</a>. So after arriving
at x-coordinate 69, the teacher turns round and moves one step forward to reach
his destination.
</div>
<div class="paragraph">
One possible fix for this is to make the teacher's destination x-coordinate 69
instead of 70:
</div>
<div class="paragraph">
POKE 16564,69 <a href="../asm/40AE.html">($40B4,$45)</a>
</div>
<div class="paragraph">
Another possible (and perhaps better) fix is to define the x-coordinate of the
top of the staircase leading down to the Exam Room as 77 instead of 76. This
makes sense because 77 matches the x-coordinate used in the Spectrum version
and by the routine at <a href="../asm/34B5.html">$34B5</a> that moves ERIC one step down a staircase, and is
also 7 cells to the right of the bottom of the staircase, which is defined as
70 in the fourth entry of the table at <a href="../asm/4440.html">$4440</a> (7 cells being the height of the
staircase).
</div>
<div class="paragraph">
POKE 17508,77 <a href="../asm/4454.html#4464">($4464,$4D)</a>
</div>
</div>
<div><span id="doubleStaircases"></span></div>
<div class="box box-1">
<div class="box-title">Double staircases</div>
<div class="paragraph">
When a character is looking for ERIC, if he has to go down a staircase on the
left side of the skool, he will start at x-coordinate 12 instead of the usual
13, which makes him appear to be walking inside the staircase instead of on it.
Similarly, if the character looking for ERIC has to go down a staircase
on the right side of the skool, he will start at x-coordinate 77 instead of the
usual 76, which produces a similar effect.
</div>
<div class="paragraph">
The reason has more to do with the way characters other than ERIC are animated
when going down a staircase than it has to do with the x-coordinates of the
tops of the staircases themselves. When ERIC proceeds from one step to the
next, he moves midstride first, and then drops to the step below as he finishes
his stride. But the other characters - in contrast to ERIC and to their
counterparts in the ZX Spectrum version - move midstride as they drop to the
step below, and then finish their stride on that step before moving to the next
one. It's this drop-first-and-finish-the-stride-later technique that accounts
for the anomalous appearance.
</div>
<div class="paragraph">
Luckily, changing this technique to match ERIC's requires just a few POKEs that
modify the relevant section of code at <a href="../asm/0C3F.html#0D37">$0D37</a>:
</div>
<div class="paragraph">
<table class="box-asm">
<tr>
<td class="address-1" colspan="1" rowspan="1">$0D37</td>
<td class="instruction" colspan="1" rowspan="1">LDA $FB</td>
<td class="box-comment" colspan="1" rowspan="1">Pick up the character's y-coordinate from <a href="../asm/00FB.html">$FB</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$0D39</td>
<td class="instruction" colspan="1" rowspan="1">STA $AD</td>
<td class="box-comment" colspan="1" rowspan="1">Copy the character's y-coordinate to <a href="../asm/00AC.html#00AD">$AD</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$0D3B</td>
<td class="instruction" colspan="1" rowspan="1">INC $AD</td>
<td class="box-comment" colspan="1" rowspan="1">Increment the y-coordinate at <a href="../asm/00AC.html#00AD">$AD</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$0D3D</td>
<td class="instruction" colspan="1" rowspan="1">JMP $0D0F</td>
<td class="box-comment" colspan="1" rowspan="1">Jump back to compute the character's next x-coordinate.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div>POKE 3383,165 ($0D37,$A5)</div>
<div>POKE 3385,133 ($0D39,$85)</div>
<div>POKE 3386,173 ($0D3A,$AD)</div>
<div>POKE 3387,230 ($0D3B,$E6)</div>
</div>
</div>
<div><span id="staircaseSaga"></span></div>
<div class="box box-2">
<div class="box-title">The staircase saga continues</div>
<div class="paragraph">
In <a href="bugs.html#doubleStaircases">Double staircases</a> above we took the approach of modifying the
staircase descent technique of a character who is looking for ERIC in order to
fix an animation bug. But what if a character is not looking for ERIC? In that
case, it's the routine at <a href="../asm/13F3.html">$13F3</a> that takes care of any trip down a staircase.
And not so luckily this time, a rather larger set of POKEs is required to
modify the relevant section of code:
</div>
<div class="paragraph">
<table class="box-asm">
<tr>
<td class="address-1" colspan="1" rowspan="1">$140A</td>
<td class="instruction" colspan="1" rowspan="1">LSR A</td>
<td class="box-comment" colspan="1" rowspan="1">Is the character midstride?</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$140B</td>
<td class="instruction" colspan="1" rowspan="1">BCC $1416</td>
<td class="box-comment" colspan="1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$140D</td>
<td class="instruction" colspan="1" rowspan="1">LDA $47</td>
<td class="box-comment" colspan="1" rowspan="1">Pick up the direction indicator from <a href="../asm/0047.html">$47</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$140F</td>
<td class="instruction" colspan="1" rowspan="1">BNE $1413</td>
<td class="box-comment" colspan="1" rowspan="1">Branch if going upstairs.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1411</td>
<td class="instruction" colspan="1" rowspan="1">INC $FB</td>
<td class="box-comment" colspan="1" rowspan="1">Increment the y-coordinate if going downstairs.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1413</td>
<td class="instruction" colspan="1" rowspan="1">JMP <a href="../asm/136F.html#1393">$1393</a></td>
<td class="box-comment" colspan="1" rowspan="1">Move the character from the midstride position.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1416</td>
<td class="instruction" colspan="1" rowspan="1">INC $26</td>
<td class="box-comment" colspan="1" rowspan="1">Move the character midstride.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1418</td>
<td class="instruction" colspan="1" rowspan="1">LDA $47</td>
<td class="box-comment" colspan="1" rowspan="1">Pick up the direction indicator from <a href="../asm/0047.html">$47</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$141A</td>
<td class="instruction" colspan="1" rowspan="1">BEQ $141E</td>
<td class="box-comment" colspan="1" rowspan="1">Branch if going downstairs.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$141C</td>
<td class="instruction" colspan="1" rowspan="1">DEC $FB</td>
<td class="box-comment" colspan="1" rowspan="1">Decrement the y-coordinate if going upstairs.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$141E</td>
<td class="instruction" colspan="1" rowspan="1">JMP <a href="../asm/322E.html">$322E</a></td>
<td class="box-comment" colspan="1" rowspan="1">Update the SRB for the character's new animatory state and location.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div>POKE 5132,9 ($140C,$09)</div>
<div>POKE 5133,165 ($140D,$A5)</div>
<div>POKE 5134,71 ($140E,$47)</div>
<div>POKE 5135,208 ($140F,$D0)</div>
<div>POKE 5136,2 ($1410,$02)</div>
<div>POKE 5137,230 ($1411,$E6)</div>
<div>POKE 5138,251 ($1412,$FB)</div>
<div>POKE 5139,76 ($1413,$4C)</div>
<div>POKE 5140,147 ($1414,$93)</div>
<div>POKE 5141,19 ($1415,$13)</div>
<div>POKE 5142,230 ($1416,$E6)</div>
<div>POKE 5143,38 ($1417,$26)</div>
<div>POKE 5144,165 ($1418,$A5)</div>
<div>POKE 5145,71 ($1419,$47)</div>
<div>POKE 5146,240 ($141A,$F0)</div>
<div>POKE 5147,2 ($141B,$02)</div>
<div>POKE 5148,198 ($141C,$C6)</div>
<div>POKE 5149,251 ($141D,$FB)</div>
<div>POKE 5150,76 ($141E,$4C)</div>
<div>POKE 5151,46 ($141F,$2E)</div>
<div>POKE 5152,50 ($1420,$32)</div>
</div>
<div class="paragraph">
With that change out of the way, it now makes sense to adjust the x-coordinates
of the tops of the staircases in the tables at <a href="../asm/4440.html">$4440</a> and <a href="../asm/4454.html">$4454</a>, for optimal
compatibility with the new technique:
</div>
<div class="paragraph">
<div>POKE 17472,12 ($4440,$0C)</div>
<div>POKE 17476,12 ($4444,$0C)</div>
<div>POKE 17504,77 ($4460,$4D)</div>
<div>POKE 17508,77 ($4464,$4D) (this is the same POKE as was used in
<a href="bugs.html#aStepTooFar">A step too far</a>)</div>
</div>
</div>
<div><span id="initialNonPlaytimes"></span></div>
<div class="box box-1">
<div class="box-title">Initial non-playtimes</div>
<div class="paragraph">
Unlike the ZX Spectrum version, the C64 version of the game does not always
start on a playtime: two of the entries in the table of initial lesson numbers
at <a href="../asm/4650.html">$4650</a> are classroom periods.
</div>
<div class="paragraph">
What's interesting is that the non-playtime lesson numbers in this table - $0C
and $3D - would be playtimes if the main timetable at <a href="../asm/5D00.html">$5D00</a> were exactly the
same as the one in the ZX Spectrum version. This strongly suggests that these
initial non-playtimes are not intentional.
</div>
</div>
<div><span id="invisibilityRange"></span></div>
<div class="box box-2">
<div class="box-title">Invisibility range</div>
<div class="paragraph">
The routine at <a href="../asm/0BAC.html">$0BAC</a>, which is used to calculate the coordinate ranges within
which a character can be seen, does not always compute the minimum x-coordinate
correctly. The most obvious consequence of this miscalculation is that ERIC can
flagrantly violate the skool rules in front of a teacher, without getting
lines, when he's to the right of that teacher and in one of the following
locations:
</div>
<div class="paragraph">
<ul class="">
<li>on the top floor with x-coordinate &lt; 47 (to the left of the blue shield in the Reading Room)</li>
<li>on the middle floor with x-coordinate &lt; 28 (to the left of the front seat in the White Room)</li>
</ul>
</div>
<div class="paragraph">
Specifically, in these situations ERIC's horizontal visibility range is
calculated as [x, x+10] (where 'x' is ERIC's x-coordinate) instead
of [x&#8722;10, x+10], which means any teacher to his left is effectively
unable to see him.
</div>
<div class="paragraph">
<div>POKE 3075,207 <a href="../asm/0BAC.html#0C02">($0C03,$CF)</a></div>
<div>POKE 3110,207 <a href="../asm/0BAC.html#0C25">($0C26,$CF)</a></div>
<div>POKE 3118,207 <a href="../asm/0BAC.html#0C2D">($0C2E,$CF)</a></div>
</div>
</div>
<div><span id="creaksSuperiorVision"></span></div>
<div class="box box-1">
<div class="box-title">MR CREAK's superior vision</div>
<div class="paragraph">
In contrast to those situations where ERIC's horizontal visibility range is
reduced from [x&#8722;10, x+10] to [x, x+10] (see <a href="bugs.html#invisibilityRange">Invisibility range</a>),
there are other situations in which the upper bound of that range is increased
from x+10 to x+13 for MR CREAK in particular. This means, for example, that
when MR CREAK is at x-coordinate 34 in the White Room waiting for EINSTEIN to
tell tales, he can see ERIC (and give him lines for hitting, firing etc.) even
if he's standing in the White Room doorway 13 spaces away at x-coordinate 21.
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="csv" src="../images/udgs/csv.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
The reason for this is as follows. When the check is made whether ERIC should
be given lines, his visibility range is calculated by the routine at <a href="../asm/0BAC.html">$0BAC</a>,
and the minimum and maximum y- and x-coordinates of that range are stored at
$73, $74, $75 and $76. Then the routine at <a href="../asm/0E59.html">$0E59</a> checks whether any of the
teachers are in that range. It does this by calling the routine at <a href="../asm/0D67.html">$0D67</a> for
each teacher in turn: MR WACKER first, then MR ROCKITT, then MR WITHIT, and
finally MR CREAK. But the routine at <a href="../asm/0D67.html">$0D67</a> is rather careless with the
maximum x-coordinate. For each teacher checked, the maximum x-coordinate at $76
is incremented if that teacher's x-coordinate is at least equal to the minimum
x-coordinate. So by the time MR CREAK is checked, the maximum x-coordinate of
ERIC's visibility range has increased by up to 3.
</div>
<div class="paragraph">
In addition, for each teacher checked by the routine at <a href="../asm/0D67.html">$0D67</a>, the maximum
y-coordinate at $74 is incremented if that teacher is within the x-coordinate
range and has a y-coordinate at least equal to the minimum y-coordinate. So in
very specific (and unlikely) situations, MR CREAK's superior vision can extend
vertically as well as horizontally.
</div>
</div>
<div><span id="offByOne"></span></div>
<div class="box box-2">
<div class="box-title">Off by one</div>
<div class="paragraph">
The skool region data tables for the <a href="../asm/46A0.html">top floor</a>, <a href="../asm/46AC.html">middle floor</a>
and <a href="../asm/46B6.html">bottom floor</a> are the same as those in the ZX Spectrum version, but
they are interpreted differently: each x-coordinate they contain is the maximum
x-coordinate of the current region rather than the minimum x-coordinate of the
next region along.
</div>
<div class="paragraph">
One obvious consequence of this is that ERIC is considered to be inside the
head's study (and will be given lines accordingly) even when he's standing just
outside the doorway.
</div>
<div class="paragraph">
<img alt="obo" src="../images/udgs/obo.png" />
</div>
</div>
<div><span id="disappearingPellet"></span></div>
<div class="box box-1">
<div class="box-title">The disappearing pellet</div>
<div class="paragraph">
If a pellet bounces off a teacher's head on the top floor of the skool, it will
disappear before it reaches the top of the screen. The reason for this is that
the routine at <a href="../asm/31EA.html">$31EA</a> (which updates the display) ignores the first ten bytes
of the screen refresh buffer at <a href="../asm/4008.html">$4008</a>, which correspond to the top two rows
of the screen. This means that anything at y-coordinate 0 or 1 is never drawn.
</div>
</div>
<div><span id="leapsOfFaith"></span></div>
<div class="box box-2">
<div class="box-title">Leaps of faith</div>
<div class="paragraph">
If you've spent any time in the Exam Room knocking boys out in order to jump on
them and thence to the shields, but been left wondering whether this method is
actually reliable, rest assured that in fact it most certainly is not.
</div>
<div class="paragraph">
The reason is that the routine at <a href="../asm/1640.html">$1640</a>, which checks whether ERIC is
standing on a boy, is rather careless with ERIC's x-coordinate. The routine
stores this x-coordinate at $D3, and then enters a loop to compare the value
stored there with the x-coordinate of each boy whose y-coordinate is one more
than ERIC's (i.e. underneath him). The problem is that the value at $D3 is
either decremented or incremented by one on each pass through the loop
depending on the boy's x-coordinate relative to ERIC's. So the comparison works
for the first boy checked, but is off by one for the next boy, then possibly
off by two for the next boy after that, and so on.
</div>
<div class="paragraph">
The following POKEs fix the section of code at <a href="../asm/1640.html#166B">$166B</a> to make the x-coordinate
comparisons consistent:
</div>
<div class="paragraph">
<table class="box-asm">
<tr>
<td class="address-1" colspan="1" rowspan="1">$166B</td>
<td class="instruction" colspan="1" rowspan="1">DEC $D3</td>
<td class="box-comment" colspan="1" rowspan="1">Decrement the comparison x-coordinate (C) at <a href="../asm/00D3.html">$D3</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$166D</td>
<td class="instruction" colspan="1" rowspan="1">LDA $FC</td>
<td class="box-comment" colspan="1" rowspan="1">Pick up the character's x-coordinate from <a href="../asm/00FB.html#00FC">$FC</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$166F</td>
<td class="instruction" colspan="1" rowspan="1">CMP $D3</td>
<td class="box-comment" colspan="1" rowspan="1">Compare the character's x-coordinate with C&#8722;1.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1671</td>
<td class="instruction" colspan="1" rowspan="1">INC $D3</td>
<td class="box-comment" colspan="1" rowspan="1">Reset the x-coordinate at <a href="../asm/00D3.html">$D3</a> back to C.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1673</td>
<td class="instruction" colspan="1" rowspan="1">BCC $168E</td>
<td class="box-comment" colspan="1" rowspan="1">Branch if the character's x-coordinate is less than C&#8722;1.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1675</td>
<td class="instruction" colspan="1" rowspan="1">LDA $D3</td>
<td class="box-comment" colspan="1" rowspan="1">Pick up the comparison x-coordinate (C) from <a href="../asm/00D3.html">$D3</a>.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1677</td>
<td class="instruction" colspan="1" rowspan="1">ADC #00</td>
<td class="box-comment" colspan="1" rowspan="1">Add 1 to it.</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$1679</td>
<td class="instruction" colspan="1" rowspan="1">CMP $FC</td>
<td class="box-comment" colspan="1" rowspan="1">Is the character's x-coordinate greater than C+1?</td>
</tr>
<tr>
<td class="address-1" colspan="1" rowspan="1">$167B</td>
<td class="instruction" colspan="1" rowspan="1">BCC $168E</td>
<td class="box-comment" colspan="1" rowspan="1">Branch if so.</td>
</tr>
</table>
</div>
<div class="paragraph">
<div>POKE 5745,230 ($1671,$E6)</div>
<div>POKE 5746,211 ($1672,$D3)</div>
<div>POKE 5747,144 ($1673,$90)</div>
<div>POKE 5748,25 ($1674,$19)</div>
<div>POKE 5749,165 ($1675,$A5)</div>
<div>POKE 5751,105 ($1677,$69)</div>
<div>POKE 5752,0 ($1678,$00)</div>
</div>
</div>
<div><span id="misplacedMessageBox"></span></div>
<div class="box box-1">
<div class="box-title">Misplaced message box</div>
<div class="paragraph">
When a teacher is close (but not too close!) to the left edge of the visible
play area and either gives lines or reveals a safe combination letter, the
8-cell-wide message box above his head may be drawn with the leftmost one or
two cell columns missing.
</div>
<div class="paragraph">
The reason for this lies in how the routine at <a href="../asm/2043.html">$2043</a> computes the
x-coordinate of sprite #1, which holds the contents of the leftmost three cell
columns (24 pixel columns) of the message box. In the following discussion, we
will use T to denote the teacher's play area x-coordinate (0-95), S to denote
the play area x-coordinate of the leftmost column of the skool on screen (0, 8,
16, 24...56), and S' to denote the play area x-coordinate of the leftmost
column of the skool off screen (40, 48, 56, 64...96, i.e. S+40).
</div>
<div class="paragraph">
When S&gt;T&#8722;4 (meaning there is a gap of one, two or three cell columns
between the teacher and the left edge of the visible play area), the
x-coordinate of sprite #1 is set to 32. This puts a 1-cell-wide gap between the
message box and the left edge of the visible play area. (Remember that sprite
x-coordinates 0-23 and 344-512 are outside the visible area of the screen, and
only x-coordinates 24-343 are within it.)
</div>
<div class="paragraph">
But when S&lt;=T&#8722;4, the x-coordinate of sprite #1 is set to
8(T&#8722;S&#8722;3). This means that, in particular, when S=T&#8722;4 (meaning
there is a gap of exactly four cell columns between the teacher and the left
edge of the visible play area), the x-coordinate of sprite #1 is set to 8,
which means the leftmost two cell columns of the message box are not visible.
And when S=T&#8722;5 (meaning there is a gap of exactly five cell columns
between the teacher and the left edge of the visible play area), the
x-coordinate of sprite #1 is set to 16, which means the leftmost cell column of
the message box is not visible.
</div>
<div class="paragraph">
So much for the left side of the screen. What about when a teacher is close to
the right edge of the visible play area? It turns out that the message box is
not exactly ideally placed in that situation either.
</div>
<div class="paragraph">
When S'&lt;=T+5 (meaning there is a gap of one or two cell columns between the
teacher and the right edge of the visible play area), the x-coordinate of
sprite #1 is set to 256. This puts a 3-cell-wide gap between the message box
and the right edge of the visible play area, which means it's nowhere near
being centred over the teacher's head.
</div>
<div class="paragraph">
In summary, it's as if the routine at <a href="../asm/2043.html">$2043</a> assumes that the x-coordinate of
the left edge of visible area of the screen, as far as sprites are concerned,
is 0 instead of 24.
</div>
<div class="paragraph">
POKE 8297,0 <a href="../asm/2043.html#2067">($2069,$00)</a> - sets the x-coordinate of sprite #1 to
8(T&#8722;S) when S&lt;=T&#8722;4 or S'&gt;T+5, which roughly centres the
message box above the teacher's head.
</div>
<div class="paragraph">
POKE 8305,3 <a href="../asm/2043.html#2070">($2071,$03)</a> - sets the minimum x-coordinate of sprite #1
to 24 instead of 32 (used when S&gt;T&#8722;4), which pushes the message box up
against the left edge of the visible play area.
</div>
<div class="paragraph">
POKE 8310,35 <a href="../asm/2043.html#2075">($2076,$23)</a> - sets the maximum x-coordinate of sprite #1
to 280 instead of 256 (used when S'&lt;=T+5), which pushes the message box up
against the right edge of the visible play area.
</div>
</div>
<div><span id="brokenBookcase"></span></div>
<div class="box box-2">
<div class="box-title">Broken bookcase</div>
<div class="paragraph">
The bottom of the bookcase on the left in the Revision Library seems to have
been vandalised since it was first used in the ZX Spectrum version:
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="bookcase1" src="../images/udgs/bookcase1.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
To restore the bookcase to something close to its former glory:
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="bookcase2" src="../images/udgs/bookcase2.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><div>POKE 24597,255 ($6015,$FF)</div> <div>POKE 24853,0 ($6115,$00)</div> <div>POKE 25109,0 ($6215,$00)</div> <div>POKE 25365,0 ($6315,$00)</div> <div>POKE 25621,0 ($6415,$00)</div> <div>POKE 25877,0 ($6515,$00)</div> <div>POKE 26133,0 ($6615,$00)</div> <div>POKE 26389,0 ($6715,$00)</div></td>
</tr>
</table>
</div>
<div class="paragraph">
These POKEs also affect the sofa and the window on the left in the staff room
(specifically the tiles at (3,9), (8,11) and (9,11)), but in a way that can be
overlooked for the sake of the bookcase:
</div>
<div class="paragraph">
<table class="gallery">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="staffroom1" src="../images/udgs/staffroom1.png" /></td>
<td class="" colspan="1" rowspan="1"><img alt="staffroom2" src="../images/udgs/staffroom2.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">Before</td>
<td class="" colspan="1" rowspan="1">After</td>
</tr>
</table>
</div>
<div class="paragraph">
Nearly there, but something is still not quite right with the books on the
bottom shelf on the right-hand side:
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="books1" src="../images/udgs/books1.png" /></td>
</tr>
</table>
</div>
<div class="paragraph">
To fix them:
</div>
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="books2" src="../images/udgs/books2.png" /></td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><div>POKE 25814,85 ($64D6,$55)</div> <div>POKE 26070,171 ($65D6,$AB)</div> <div>POKE 26326,87 ($66D6,$57)</div> <div>POKE 26582,175 ($67D6,$AF)</div></td>
</tr>
</table>
</div>
</div>
<div><span id="missAndHit"></span></div>
<div class="box box-1">
<div class="box-title">Miss and hit</div>
<div class="paragraph">
ERIC can be knocked out by BOY WONDER's catapult pellet even when he's sitting
on the floor or is already lying on the floor (and the pellet should really fly
straight over his head instead). The best way to reproduce this bug is to stand
(or sit) in BOY WONDER's line of fire in a classroom while everyone's waiting
for the teacher to show up for the lesson.
</div>
</div>
<div><span id="allPlayAndNoWork"></span></div>
<div class="box box-2">
<div class="box-title">All play and no work</div>
<div class="paragraph">
In lesson <a href="../lessons/E3.html">$E3</a> (MR ROCKITT - EXAM ROOM), little boys 4-8 head
off to the White Room in accordance with their personal timetables, but no
teacher ever arrives to start the lesson.
</div>
<div class="paragraph">
POKE 34531,134 <a href="../asm/86E0.html#86E3">($86E3,$86)</a> (sends MR CREAK to the White Room)
</div>
</div>
<div><span id="waitingForEinstein"></span></div>
<div class="box box-1">
<div class="box-title">Waiting for EINSTEIN</div>
<div class="paragraph">
Before wiping the board and getting a lesson under way, ERIC's teacher will
wait for EINSTEIN to sit down first: see <a href="../asm/0B3B.html">$0B3B</a>. This makes sense at the
beginning of a lesson, but that same routine is called several times during the
course of a lesson (see <a href="../asm/0A58.html">$0A58</a>) to check whether ERIC is present, which means
that the teacher will also stop whatever he's doing and wait for EINSTEIN to
sit down before continuing on those occasions too. This is not really
noticeable except during lessons where there is no question-and-answer session
taking place between the teacher and the swot, and the teacher is pacing up and
down in front of the blackboard instead. During those lessons, the call to
<a href="../asm/0B3B.html">$0B3B</a> is made each time the teacher has reached the point where he is just
about to turn round; if EINSTEIN is not sitting in a chair at that time
(because ERIC has pushed him out of his seat, for example), the teacher will
wait until EINSTEIN is back in his seat before turning round.
</div>
<div class="paragraph">
This phenomenon can be made more readily reproducible and observable by using
the following POKEs:
</div>
<div class="paragraph">
<div>POKE 7349,20 <a href="../asm/1CB4.html">($1CB5,$14)</a> (to lengthen the delay before a
dethroned character rises)</div>
<div>POKE 2850,0 <a href="../asm/0A58.html#0B1F">($0B22,$00)</a> (to make every lesson a
non-question-and-answer lesson)</div>
</div>
</div>
<div><span id="wackersNumberBlindness"></span></div>
<div class="box box-2">
<div class="box-title">WACKER's number blindness</div>
<div class="paragraph">
If ERIC has exactly 10000 lines, MR WACKER will come rushing to ERIC's side and
say "YOU HAVE OVER 10000 LINES TO WRITE ERIC...". Does the headmaster not know
how to count, or does he actually think that 10000 > 10000? Either way, this is
poor form for a maths teacher.
</div>
<div class="paragraph">
POKE 7538,233 <a href="../asm/1D4A.html#1D71">($1D72,$E9)</a> (keeps MR WACKER at bay until ERIC's lines
total exceeds 10000)
</div>
</div>
<div><span id="rockittExamRoom"></span></div>
<div class="box box-1">
<div class="box-title">MR ROCKITT as a boy</div>
<div class="paragraph">
In lesson <a href="../lessons/E5.html">$E5</a> (REVISION LIBRARY), MR ROCKITT paces up and down
in the Exam Room like a little boy, waiting for a teacher who never arrives.
</div>
<div class="paragraph">
POKE 34021,188 <a href="../asm/84E0.html#84E5">($84E5,$BC)</a> (sends MR ROCKITT to the staff room)
</div>
</div>
<div><span id="typo"></span></div>
<div class="box box-2">
<div class="box-title">Misspelt element</div>
<div class="paragraph">
'Phosphorous' (at <a href="../asm/4EBC.html">$4EBC</a>) is misspelt; it should be 'Phosphorus'.
</div>
</div>
<div><span id="emptyClass"></span></div>
<div class="box box-1">
<div class="box-title">MR CREAK and the empty class</div>
<div class="paragraph">
Lesson <a href="../lessons/E6.html">$E6</a> (REVISION LIBRARY) has MR CREAK teaching an empty
class in the Reading Room.
</div>
<div class="paragraph">
POKE 34534,188 <a href="../asm/86E0.html#86E6">($86E6,$BC)</a> (sends MR CREAK to the staff room)
</div>
</div>
<div><span id="chairHit"></span></div>
<div class="box box-2">
<div class="box-title">Share a chair</div>
<div class="paragraph">
If ERIC hits a character who is sitting on a chair, and then quickly sits in
the chair just vacated, ERIC will not be pushed out of the chair when the
character rises and takes his seat again.
</div>
</div>
<div><span id="absentTearaway"></span></div>
<div class="box box-1">
<div class="box-title">800 LINES BOY WONDER - NOW WHERE ARE YOU?</div>
<div class="paragraph">
In lesson <a href="../lessons/EC.html">$EC</a> (MR WACKER - WHITE ROOM), BOY WONDER is in the
Revision Library (on his own, as it happens). However, if EINSTEIN tells on BOY
WONDER for writing on the board, MR WACKER will still give lines to the absent
tearaway. (Perhaps the ceiling in the White Room conducts sound well enough for
BOY WONDER to hear the admonition.) The same thing may also happen in lesson
<a href="../lessons/ED.html">$ED</a> (MR WITHIT - WHITE ROOM), when BOY WONDER is once again in
the Revision Library (this time accompanied by ANGELFACE).
</div>
</div>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>