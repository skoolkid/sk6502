<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $0DD4</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="0D91.html">$0D91</a>
</td>
<td class="up">Up: <a href="../maps/all.html#0DD4">Map</a></td>
<td class="next">
Next: <a href="0E35.html">$0E35</a>
</td>
</tr>
</table>
<div class="description">$0DD4: Prepare message box sprite graphic data from the text graphic buffer</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="2043.html">$2043</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">(<a href="004D.html#0057">$57</a>)</td>
<td class="register-desc">$06 (top line) or $21 (bottom line)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="0DD4"></span>$0DD4</td>
<td class="instruction">LDA #$45</td>
<td class="comment-1" rowspan="4">$45C0 is in the text graphic buffer at <a href="4500.html">$4500</a>. Store this address at <a href="004D.html#004E">$4E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0DD6"></span>$0DD6</td>
<td class="instruction">STA $4F</td>
</tr>
<tr>
<td class="address-1"><span id="0DD8"></span>$0DD8</td>
<td class="instruction">LDA #$C0</td>
</tr>
<tr>
<td class="address-1"><span id="0DDA"></span>$0DDA</td>
<td class="instruction">STA $4E</td>
</tr>
<tr>
<td class="address-1"><span id="0DDC"></span>$0DDC</td>
<td class="instruction">LDA #$CA</td>
<td class="comment-1" rowspan="6">Store the address $CAC6 or $CAE1 (in the upper and lower portions of the graphic data for the lines message sprite at $CAC0) at <a href="004D.html#0050">$50</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0DDE"></span>$0DDE</td>
<td class="instruction">STA $51</td>
</tr>
<tr>
<td class="address-1"><span id="0DE0"></span>$0DE0</td>
<td class="instruction">LDA #$C0</td>
</tr>
<tr>
<td class="address-1"><span id="0DE2"></span>$0DE2</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="0DE3"></span>$0DE3</td>
<td class="instruction">ADC $57</td>
</tr>
<tr>
<td class="address-1"><span id="0DE5"></span>$0DE5</td>
<td class="instruction">STA $50</td>
</tr>
<tr>
<td class="address-1"><span id="0DE7"></span>$0DE7</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">Initialise the index in <span class="register">Y</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="0DE9"></span>$0DE9</td>
<td class="instruction">LDA #$08</td>
<td class="comment-1" rowspan="2">Initialise the tile counter at <a href="004D.html#0057">$57</a> to 8</td>
</tr>
<tr>
<td class="address-1"><span id="0DEB"></span>$0DEB</td>
<td class="instruction">STA $57</td>
</tr>
<tr>
<td class="address-2"><span id="0DED"></span>$0DED</td>
<td class="instruction">LDA #$08</td>
<td class="comment-1" rowspan="2">Initialise the byte counter at <a href="004D.html#0056">$56</a> to 8</td>
</tr>
<tr>
<td class="address-1"><span id="0DEF"></span>$0DEF</td>
<td class="instruction">STA $56</td>
</tr>
<tr>
<td class="address-2"><span id="0DF1"></span>$0DF1</td>
<td class="instruction">LDA ($4E),Y</td>
<td class="comment-1" rowspan="1">Pick up a byte from the text graphic buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="0DF3"></span>$0DF3</td>
<td class="instruction">STA ($50),Y</td>
<td class="comment-1" rowspan="1">Copy it into the sprite graphic data area at $CAC0, $CB00 or $CB40.</td>
</tr>
<tr>
<td class="address-1"><span id="0DF5"></span>$0DF5</td>
<td class="instruction">INC $4E</td>
<td class="comment-1" rowspan="3">Increment the text graphic buffer address at <a href="004D.html#004E">$4E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0DF7"></span>$0DF7</td>
<td class="instruction">BNE <a href="0DD4.html#0DFB">$0DFB</a></td>
</tr>
<tr>
<td class="address-1"><span id="0DF9"></span>$0DF9</td>
<td class="instruction">INC $4F</td>
</tr>
<tr>
<td class="address-2"><span id="0DFB"></span>$0DFB</td>
<td class="instruction">LDA $50</td>
<td class="comment-1" rowspan="6">Add 3 to the sprite graphic data address at <a href="004D.html#0050">$50</a>. This makes it point at the next pixel row down in the same column.</td>
</tr>
<tr>
<td class="address-1"><span id="0DFD"></span>$0DFD</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="0DFE"></span>$0DFE</td>
<td class="instruction">ADC #$03</td>
</tr>
<tr>
<td class="address-1"><span id="0E00"></span>$0E00</td>
<td class="instruction">BCC <a href="0DD4.html#0E04">$0E04</a></td>
</tr>
<tr>
<td class="address-1"><span id="0E02"></span>$0E02</td>
<td class="instruction">INC $51</td>
</tr>
<tr>
<td class="address-2"><span id="0E04"></span>$0E04</td>
<td class="instruction">STA $50</td>
</tr>
<tr>
<td class="address-1"><span id="0E06"></span>$0E06</td>
<td class="instruction">DEC $56</td>
<td class="comment-1" rowspan="1">Decrement the byte counter at <a href="004D.html#0056">$56</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0E08"></span>$0E08</td>
<td class="instruction">BNE <a href="0DD4.html#0DF1">$0DF1</a></td>
<td class="comment-1" rowspan="1">Branch back until all 8 bytes of a tile have been copied.</td>
</tr>
<tr>
<td class="address-1"><span id="0E0A"></span>$0E0A</td>
<td class="instruction">LDA $50</td>
<td class="comment-1" rowspan="6">Subtract 23 from the sprite graphic data address at <a href="004D.html#0050">$50</a>. This makes it point at the top pixel row in the next column to the right.</td>
</tr>
<tr>
<td class="address-1"><span id="0E0C"></span>$0E0C</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="0E0D"></span>$0E0D</td>
<td class="instruction">SBC #$17</td>
</tr>
<tr>
<td class="address-1"><span id="0E0F"></span>$0E0F</td>
<td class="instruction">BCS <a href="0DD4.html#0E13">$0E13</a></td>
</tr>
<tr>
<td class="address-1"><span id="0E11"></span>$0E11</td>
<td class="instruction">DEC $51</td>
</tr>
<tr>
<td class="address-2"><span id="0E13"></span>$0E13</td>
<td class="instruction">STA $50</td>
</tr>
<tr>
<td class="address-1"><span id="0E15"></span>$0E15</td>
<td class="instruction">DEC $57</td>
<td class="comment-1" rowspan="1">Decrement the tile counter at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0E17"></span>$0E17</td>
<td class="instruction">BEQ <a href="0DD4.html#0E34">$0E34</a></td>
<td class="comment-1" rowspan="1">Return if we're done.</td>
</tr>
<tr>
<td class="address-1"><span id="0E19"></span>$0E19</td>
<td class="instruction">LDA $57</td>
<td class="comment-1" rowspan="1">Pick up the tile counter from <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="0E1B"></span>$0E1B</td>
<td class="instruction">CMP #$05</td>
<td class="comment-1" rowspan="1">Is it 5 now?</td>
</tr>
<tr>
<td class="address-1"><span id="0E1D"></span>$0E1D</td>
<td class="instruction">BEQ <a href="0DD4.html#0E26">$0E26</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="0E1F"></span>$0E1F</td>
<td class="instruction">CMP #$02</td>
<td class="comment-1" rowspan="1">Is it 2 now?</td>
</tr>
<tr>
<td class="address-1"><span id="0E21"></span>$0E21</td>
<td class="instruction">BEQ <a href="0DD4.html#0E26">$0E26</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="0E23"></span>$0E23</td>
<td class="instruction">JMP <a href="0DD4.html#0DED">$0DED</a></td>
<td class="comment-1" rowspan="1">Jump back to copy the next tile.</td>
</tr>
<tr>
<td class="address-2"><span id="0E26"></span>$0E26</td>
<td class="instruction">LDA $50</td>
<td class="comment-1" rowspan="6">Add 61 to the sprite graphic data address at <a href="004D.html#0050">$50</a>. This makes it point at the top pixel row in the first tile of the next lines message sprite graphic data area at $CB00 or $CB40.</td>
</tr>
<tr>
<td class="address-1"><span id="0E28"></span>$0E28</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="0E29"></span>$0E29</td>
<td class="instruction">ADC #$3D</td>
</tr>
<tr>
<td class="address-1"><span id="0E2B"></span>$0E2B</td>
<td class="instruction">BCC <a href="0DD4.html#0E2F">$0E2F</a></td>
</tr>
<tr>
<td class="address-1"><span id="0E2D"></span>$0E2D</td>
<td class="instruction">INC $51</td>
</tr>
<tr>
<td class="address-2"><span id="0E2F"></span>$0E2F</td>
<td class="instruction">STA $50</td>
</tr>
<tr>
<td class="address-1"><span id="0E31"></span>$0E31</td>
<td class="instruction">JMP <a href="0DD4.html#0DED">$0DED</a></td>
<td class="comment-1" rowspan="1">Jump back to copy the next tile.</td>
</tr>
<tr>
<td class="address-2"><span id="0E34"></span>$0E34</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="0D91.html">$0D91</a>
</td>
<td class="up">Up: <a href="../maps/all.html#0DD4">Map</a></td>
<td class="next">
Next: <a href="0E35.html">$0E35</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>