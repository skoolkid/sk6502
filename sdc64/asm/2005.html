<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $2005</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2004.html">$2004</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2005">Map</a></td>
<td class="next">
Next: <a href="2043.html">$2043</a>
</td>
</tr>
</table>
<div class="description">$2005: Write a message into the text graphic buffer</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="2043.html">$2043</a>, <a href="2573.html">$2573</a>, <a href="2620.html">$2620</a>, <a href="2BB0.html">$2BB0</a> and <a href="BFF5.html">$BFF5</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">(<a href="00D6.html">$D6,$D7</a>)</td>
<td class="register-desc">Address of the message</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="2005"></span>$2005</td>
<td class="instruction">JSR <a href="212A.html">$212A</a></td>
<td class="comment-1" rowspan="1">Clear the text graphic buffer at <a href="4500.html">$4500</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2008"></span>$2008</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">Initialise the message character index to 0.</td>
</tr>
<tr>
<td class="address-2"><span id="200A"></span>$200A</td>
<td class="instruction">LDA ($D6),Y</td>
<td class="comment-1" rowspan="2">Collect a character code from the message to be written and store it at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="200C"></span>$200C</td>
<td class="instruction">STA $57</td>
</tr>
<tr>
<td class="address-1"><span id="200E"></span>$200E</td>
<td class="instruction">BEQ <a href="2005.html#2042">$2042</a></td>
<td class="comment-1" rowspan="1">Return if the message is finished.</td>
</tr>
<tr>
<td class="address-1"><span id="2010"></span>$2010</td>
<td class="instruction">CMP #$20</td>
<td class="comment-1" rowspan="1">Is the character printable?</td>
</tr>
<tr>
<td class="address-1"><span id="2012"></span>$2012</td>
<td class="instruction">BCS <a href="2005.html#2037">$2037</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="2014"></span>$2014</td>
<td class="instruction">LDA #$47</td>
<td class="comment-1" rowspan="4">Store <a href="4780.html">$4780</a> (ERIC) at <a href="00D6.html">$D6</a></td>
</tr>
<tr>
<td class="address-1"><span id="2016"></span>$2016</td>
<td class="instruction">STA $D7</td>
</tr>
<tr>
<td class="address-1"><span id="2018"></span>$2018</td>
<td class="instruction">LDA #$80</td>
</tr>
<tr>
<td class="address-1"><span id="201A"></span>$201A</td>
<td class="instruction">STA $D6</td>
</tr>
<tr>
<td class="address-1"><span id="201C"></span>$201C</td>
<td class="instruction">LDA $57</td>
<td class="comment-1" rowspan="1">Pick up the unprintable character code from <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="201E"></span>$201E</td>
<td class="instruction">AND #$EF</td>
<td class="comment-1" rowspan="1">Reset bit 4. Now 1 &lt;= <span class="register">A</span> &lt;= 15.</td>
</tr>
<tr>
<td class="address-1"><span id="2020"></span>$2020</td>
<td class="instruction">ASL A</td>
<td class="comment-1" rowspan="9">Multiply <span class="register">A</span> by 14.</td>
</tr>
<tr>
<td class="address-1"><span id="2021"></span>$2021</td>
<td class="instruction">STA $57</td>
</tr>
<tr>
<td class="address-1"><span id="2023"></span>$2023</td>
<td class="instruction">ASL A</td>
</tr>
<tr>
<td class="address-1"><span id="2024"></span>$2024</td>
<td class="instruction">STA $56</td>
</tr>
<tr>
<td class="address-1"><span id="2026"></span>$2026</td>
<td class="instruction">ASL A</td>
</tr>
<tr>
<td class="address-1"><span id="2027"></span>$2027</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="2028"></span>$2028</td>
<td class="instruction">ADC $56</td>
</tr>
<tr>
<td class="address-1"><span id="202A"></span>$202A</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="202B"></span>$202B</td>
<td class="instruction">ADC $57</td>
</tr>
<tr>
<td class="address-1"><span id="202D"></span>$202D</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="3">Add this value to the address stored at <a href="00D6.html">$D6</a>, giving the address of the name of one of the boys or teachers.</td>
</tr>
<tr>
<td class="address-1"><span id="202E"></span>$202E</td>
<td class="instruction">ADC $D6</td>
</tr>
<tr>
<td class="address-1"><span id="2030"></span>$2030</td>
<td class="instruction">STA $D6</td>
</tr>
<tr>
<td class="address-1"><span id="2032"></span>$2032</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="1">Initialise the message character index to 0.</td>
</tr>
<tr>
<td class="address-1"><span id="2034"></span>$2034</td>
<td class="instruction">JMP <a href="2005.html#200A">$200A</a></td>
<td class="comment-1" rowspan="1">Jump back to deal with the new message.</td>
</tr>
<tr>
<td class="address-2"><span id="2037"></span>$2037</td>
<td class="instruction">INY</td>
<td class="comment-1" rowspan="3">Increment the message character index in <span class="register">Y</span> and save it temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="2038"></span>$2038</td>
<td class="instruction">TYA</td>
</tr>
<tr>
<td class="address-1"><span id="2039"></span>$2039</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="203A"></span>$203A</td>
<td class="instruction">JSR <a href="2156.html">$2156</a></td>
<td class="comment-1" rowspan="1">Insert the appropriate font character bitmap into the text graphic buffer at <a href="4500.html">$4500</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="203D"></span>$203D</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="2">Restore the message character index to <span class="register">Y</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="203E"></span>$203E</td>
<td class="instruction">TAY</td>
</tr>
<tr>
<td class="address-1"><span id="203F"></span>$203F</td>
<td class="instruction">JMP <a href="2005.html#200A">$200A</a></td>
<td class="comment-1" rowspan="1">Jump back to deal with the next character in the message.</td>
</tr>
<tr>
<td class="address-2"><span id="2042"></span>$2042</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2004.html">$2004</a>
</td>
<td class="up">Up: <a href="../maps/all.html#2005">Map</a></td>
<td class="next">
Next: <a href="2043.html">$2043</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>