<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $20F5</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2043.html">$2043</a>
</td>
<td class="up">Up: <a href="../maps/all.html#20F5">Map</a></td>
<td class="next">
Next: <a href="212A.html">$212A</a>
</td>
</tr>
</table>
<div class="description">$20F5: Insert a pixel column into the text graphic buffer</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="213B.html">$213B</a> and <a href="2156.html">$2156</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Pixel column</td>
</tr>
<tr>
<td class="register">(<a href="009A.html#009D">$9D</a>)</td>
<td class="register-desc">Width (in character cells) of the target message box</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="20F5"></span>$20F5</td>
<td class="instruction">LDX #$F8</td>
<td class="comment-1" rowspan="2">Initialise the pixel counter at <a href="004D.html#0056">$56</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="20F7"></span>$20F7</td>
<td class="instruction">STX $56</td>
</tr>
<tr>
<td class="address-1"><span id="20F9"></span>$20F9</td>
<td class="instruction">LDY #$00</td>
<td class="comment-1" rowspan="2">Now <span class="register">XY</span> is <a href="4500.html">$4500</a>, the address of the text graphic buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="20FB"></span>$20FB</td>
<td class="instruction">LDX #$45</td>
</tr>
<tr>
<td class="address-1"><span id="20FD"></span>$20FD</td>
<td class="instruction">STX $9F</td>
<td class="comment-1" rowspan="1">Store the MSB of this address at <a href="009A.html#009F">$9F</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="20FF"></span>$20FF</td>
<td class="instruction">LDX $9D</td>
<td class="comment-1" rowspan="2">Pick up the width of the target message box from <a href="009A.html#009D">$9D</a> and copy it to <a href="004D.html#0055">$55</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2101"></span>$2101</td>
<td class="instruction">STX $55</td>
</tr>
<tr>
<td class="address-1"><span id="2103"></span>$2103</td>
<td class="instruction">LDX $56</td>
<td class="comment-1" rowspan="2">Pick up the pixel counter from <a href="004D.html#0056">$56</a> and copy it to <a href="009A.html#009E">$9E</a> (the LSB of the text graphic buffer address).</td>
</tr>
<tr>
<td class="address-1"><span id="2105"></span>$2105</td>
<td class="instruction">STX $9E</td>
</tr>
<tr>
<td class="address-1"><span id="2107"></span>$2107</td>
<td class="instruction">ROL A</td>
<td class="comment-1" rowspan="1">Rotate a pixel from the pixel column into the carry flag.</td>
</tr>
<tr>
<td class="address-1"><span id="2108"></span>$2108</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">Save the remainder of the pixel column temporarily.</td>
</tr>
<tr>
<td class="address-2"><span id="2109"></span>$2109</td>
<td class="instruction">LDA ($9E),Y</td>
<td class="comment-1" rowspan="3">Rotate a byte in the text graphic buffer, bringing the new pixel into bit 0.</td>
</tr>
<tr>
<td class="address-1"><span id="210B"></span>$210B</td>
<td class="instruction">ROL A</td>
</tr>
<tr>
<td class="address-1"><span id="210C"></span>$210C</td>
<td class="instruction">STA ($9E),Y</td>
</tr>
<tr>
<td class="address-1"><span id="210E"></span>$210E</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="3">Store the pixel that was rotated out of bit 7 of the text graphic buffer byte in bit 0 at <a href="004D.html#0054">$54</a> temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="2110"></span>$2110</td>
<td class="instruction">ROL A</td>
</tr>
<tr>
<td class="address-1"><span id="2111"></span>$2111</td>
<td class="instruction">STA $54</td>
</tr>
<tr>
<td class="address-1"><span id="2113"></span>$2113</td>
<td class="instruction">LDA $9E</td>
<td class="comment-1" rowspan="4">Subtract 8 from the text graphic buffer address at <a href="009A.html#009E">$9E</a>. Now it points at the next graphic byte to the left.</td>
</tr>
<tr>
<td class="address-1"><span id="2115"></span>$2115</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="2116"></span>$2116</td>
<td class="instruction">SBC #$08</td>
</tr>
<tr>
<td class="address-1"><span id="2118"></span>$2118</td>
<td class="instruction">STA $9E</td>
</tr>
<tr>
<td class="address-1"><span id="211A"></span>$211A</td>
<td class="instruction">DEC $55</td>
<td class="comment-1" rowspan="1">Decrement the message box width counter at <a href="004D.html#0055">$55</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="211C"></span>$211C</td>
<td class="instruction">BEQ <a href="20F5.html#2124">$2124</a></td>
<td class="comment-1" rowspan="1">Branch if we've just finished shifting an entire pixel row of the text graphic buffer left.</td>
</tr>
<tr>
<td class="address-1"><span id="211E"></span>$211E</td>
<td class="instruction">LDA $54</td>
<td class="comment-1" rowspan="2">Pick up the pixel that was rotated out of bit 7 of the last text graphic buffer byte and rotate it into the carry flag.</td>
</tr>
<tr>
<td class="address-1"><span id="2120"></span>$2120</td>
<td class="instruction">ROR A</td>
</tr>
<tr>
<td class="address-1"><span id="2121"></span>$2121</td>
<td class="instruction">JMP <a href="20F5.html#2109">$2109</a></td>
<td class="comment-1" rowspan="1">Jump back to rotate it into the next graphic byte to the left.</td>
</tr>
<tr>
<td class="address-2"><span id="2124"></span>$2124</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">Restore the remainder of the pixel column to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="2125"></span>$2125</td>
<td class="instruction">INC $56</td>
<td class="comment-1" rowspan="1">Next pixel in the column.</td>
</tr>
<tr>
<td class="address-1"><span id="2127"></span>$2127</td>
<td class="instruction">BNE <a href="20F5.html#20FF">$20FF</a></td>
<td class="comment-1" rowspan="1">Branch back until all 8 pixels have been inserted.</td>
</tr>
<tr>
<td class="address-1"><span id="2129"></span>$2129</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="2043.html">$2043</a>
</td>
<td class="up">Up: <a href="../maps/all.html#20F5">Map</a></td>
<td class="next">
Next: <a href="212A.html">$212A</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>