<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $29C8</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="298B.html">$298B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29C8">Map</a></td>
<td class="next">
Next: <a href="2A43.html">$2A43</a>
</td>
</tr>
</table>
<div class="description">$29C8: Check whether a character has been hit by a pellet or a stampeding boy</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="0FBA.html">$0FBA</a> and <a href="2873.html">$2873</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">X</td>
<td class="register-desc">Target x-coordinate</td>
</tr>
<tr>
<td class="register">Y</td>
<td class="register-desc">Target y-coordinate</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Number of character who was hit (or 0 if nobody was hit)</td>
</tr>
<tr>
<td class="register">P</td>
<td class="register-desc">Carry flag set if a character was knocked over</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="29C8"></span>$29C8</td>
<td class="instruction">CPX $8C61</td>
<td class="comment-1" rowspan="1">Does ERIC's x-coordinate match that of the target?</td>
</tr>
<tr>
<td class="address-1"><span id="29CB"></span>$29CB</td>
<td class="instruction">BNE <a href="29C8.html#29E2">$29E2</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="29CD"></span>$29CD</td>
<td class="instruction">CPY $8C62</td>
<td class="comment-1" rowspan="1">Does ERIC's y-coordinate match that of the target?</td>
</tr>
<tr>
<td class="address-1"><span id="29D0"></span>$29D0</td>
<td class="instruction">BNE <a href="29C8.html#29E2">$29E2</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="29D2"></span>$29D2</td>
<td class="instruction">LDA $2B</td>
<td class="comment-1" rowspan="3">Set bit 4 of ERIC's status flags at <a href="002B.html">$2B</a>: ERIC has been knocked down.</td>
</tr>
<tr>
<td class="address-1"><span id="29D4"></span>$29D4</td>
<td class="instruction">ORA #$10</td>
</tr>
<tr>
<td class="address-1"><span id="29D6"></span>$29D6</td>
<td class="instruction">STA $2B</td>
</tr>
<tr>
<td class="address-1"><span id="29D8"></span>$29D8</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="2">Set ERIC's posture indicator at <a href="0014.html">$14</a> to 0: ERIC is not standing up.</td>
</tr>
<tr>
<td class="address-1"><span id="29DA"></span>$29DA</td>
<td class="instruction">STA $14</td>
</tr>
<tr>
<td class="address-1"><span id="29DC"></span>$29DC</td>
<td class="instruction">LDA #$14</td>
<td class="comment-1" rowspan="1">Character number $14 is ERIC.</td>
</tr>
<tr>
<td class="address-1"><span id="29DE"></span>$29DE</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">Set the carry flag: a character (ERIC) was knocked over.</td>
</tr>
<tr>
<td class="address-1"><span id="29DF"></span>$29DF</td>
<td class="instruction">JMP <a href="29C8.html#2A42">$2A42</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="29E2"></span>$29E2</td>
<td class="instruction">STX $0B</td>
<td class="comment-1" rowspan="2">Store the target coordinates at <a href="0007.html#000B">$0B</a> and <a href="0007.html#000C">$0C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="29E4"></span>$29E4</td>
<td class="instruction">STY $0C</td>
</tr>
<tr>
<td class="address-1"><span id="29E6"></span>$29E6</td>
<td class="instruction">JSR <a href="33BF.html">$33BF</a></td>
<td class="comment-1" rowspan="1">Restore the current character's buffer from page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="29E9"></span>$29E9</td>
<td class="instruction">LDA $60</td>
<td class="comment-1" rowspan="2">Pick up the current character number from <a href="0060.html">$60</a> and store it at <a href="002F.html">$2F</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="29EB"></span>$29EB</td>
<td class="instruction">STA $2F</td>
</tr>
<tr>
<td class="address-1"><span id="29ED"></span>$29ED</td>
<td class="instruction">LDA #$0B</td>
<td class="comment-1" rowspan="2">Set the current character number at <a href="0060.html">$60</a> to $0B (MR WACKER).</td>
</tr>
<tr>
<td class="address-1"><span id="29EF"></span>$29EF</td>
<td class="instruction">STA $60</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29F1"></span>
<div class="comments">
<div class="paragraph">
Here we enter a loop to check whether any of the teachers or main kids (besides ERIC) were hit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29F1"></span>$29F1</td>
<td class="instruction">JSR <a href="3279.html">$3279</a></td>
<td class="comment-1" rowspan="1">Copy the potential victim's character buffer to page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="29F4"></span>$29F4</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="1">Pick up the potential victim's x-coordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="29F6"></span>$29F6</td>
<td class="instruction">CMP $0B</td>
<td class="comment-1" rowspan="1">Does it match that of the target?</td>
</tr>
<tr>
<td class="address-1"><span id="29F8"></span>$29F8</td>
<td class="instruction">BNE <a href="29C8.html#2A00">$2A00</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="29FA"></span>$29FA</td>
<td class="instruction">LDA $FB</td>
<td class="comment-1" rowspan="1">Pick up the potential victim's y-coordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="29FC"></span>$29FC</td>
<td class="instruction">CMP $0C</td>
<td class="comment-1" rowspan="1">Does it match that of the target?</td>
</tr>
<tr>
<td class="address-1"><span id="29FE"></span>$29FE</td>
<td class="instruction">BEQ <a href="29C8.html#2A0B">$2A0B</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-2"><span id="2A00"></span>$2A00</td>
<td class="instruction">LDA $60</td>
<td class="comment-1" rowspan="1">Pick up the current character number from <a href="0060.html">$60</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A02"></span>$2A02</td>
<td class="instruction">CMP #$11</td>
<td class="comment-1" rowspan="1">Is it $11 (EINSTEIN)?</td>
</tr>
<tr>
<td class="address-1"><span id="2A04"></span>$2A04</td>
<td class="instruction">BEQ <a href="29C8.html#2A2E">$2A2E</a></td>
<td class="comment-1" rowspan="1">Branch if so (there is no one left to check).</td>
</tr>
<tr>
<td class="address-1"><span id="2A06"></span>$2A06</td>
<td class="instruction">INC $60</td>
<td class="comment-1" rowspan="1">Increment the current character number at <a href="0060.html">$60</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A08"></span>$2A08</td>
<td class="instruction">JMP <a href="29C8.html#29F1">$29F1</a></td>
<td class="comment-1" rowspan="1">Jump back to check the next character.</td>
</tr>
<tr>
<td class="address-2"><span id="2A0B"></span>$2A0B</td>
<td class="instruction">LDA $B1</td>
<td class="comment-1" rowspan="1">Is the potential victim currently controlled by an uninterruptible subcommand?</td>
</tr>
<tr>
<td class="address-1"><span id="2A0D"></span>$2A0D</td>
<td class="instruction">BEQ <a href="29C8.html#2A19">$2A19</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="2A0F"></span>$2A0F</td>
<td class="instruction">LDA $60</td>
<td class="comment-1" rowspan="1">Pick up the current character number from <a href="0060.html">$60</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A11"></span>$2A11</td>
<td class="instruction">CMP #$0F</td>
<td class="comment-1" rowspan="1">Is it $0B-$0E (a teacher)?</td>
</tr>
<tr>
<td class="address-1"><span id="2A13"></span>$2A13</td>
<td class="instruction">BCS <a href="29C8.html#2A00">$2A00</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="2A15"></span>$2A15</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">Clear the carry flag: no one was knocked over.</td>
</tr>
<tr>
<td class="address-1"><span id="2A16"></span>$2A16</td>
<td class="instruction">JMP <a href="29C8.html#2A31">$2A31</a></td>
<td class="comment-1" rowspan="1">Jump forward.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2A19"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="17E5.html">$17E5</a> and <a href="2696.html">$2696</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="2A19"></span>$2A19</td>
<td class="instruction">LDA #$2A</td>
<td class="comment-1" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="2A43.html">$2A43</a> into the character's buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="2A1B"></span>$2A1B</td>
<td class="instruction">STA $B1</td>
</tr>
<tr>
<td class="address-1"><span id="2A1D"></span>$2A1D</td>
<td class="instruction">LDA #$43</td>
</tr>
<tr>
<td class="address-1"><span id="2A1F"></span>$2A1F</td>
<td class="instruction">STA $B0</td>
</tr>
<tr>
<td class="address-1"><span id="2A21"></span>$2A21</td>
<td class="instruction">LDA #$14</td>
<td class="comment-1" rowspan="2">Initialise the delay counter at <a href="00B2.html">$B2</a> that determines how long the character will stay down.</td>
</tr>
<tr>
<td class="address-1"><span id="2A23"></span>$2A23</td>
<td class="instruction">STA $B2</td>
</tr>
<tr>
<td class="address-1"><span id="2A25"></span>$2A25</td>
<td class="instruction">JSR <a href="33BF.html">$33BF</a></td>
<td class="comment-1" rowspan="1">Restore the character's buffer from page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="2A28"></span>$2A28</td>
<td class="instruction">LDA $60</td>
<td class="comment-1" rowspan="1">Pick up the current character number from <a href="0060.html">$60</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A2A"></span>$2A2A</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">Set the carry flag: a character was knocked over.</td>
</tr>
<tr>
<td class="address-1"><span id="2A2B"></span>$2A2B</td>
<td class="instruction">JMP <a href="29C8.html#2A31">$2A31</a></td>
<td class="comment-1" rowspan="1">Jump forward.</td>
</tr>
<tr>
<td class="address-2"><span id="2A2E"></span>$2A2E</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0: no one was hit.</td>
</tr>
<tr>
<td class="address-1"><span id="2A30"></span>$2A30</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">Clear the carry flag: no one was hit.</td>
</tr>
<tr>
<td class="address-2"><span id="2A31"></span>$2A31</td>
<td class="instruction">STA $57</td>
<td class="comment-1" rowspan="1">Store the victim's character number (or 0) at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A33"></span>$2A33</td>
<td class="instruction">ROL A</td>
<td class="comment-1" rowspan="2">Save the carry flag in bit 0 at <a href="004D.html#0056">$56</a> temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="2A34"></span>$2A34</td>
<td class="instruction">STA $56</td>
</tr>
<tr>
<td class="address-1"><span id="2A36"></span>$2A36</td>
<td class="instruction">LDA $2F</td>
<td class="comment-1" rowspan="2">Restore the saved character number from <a href="002F.html">$2F</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A38"></span>$2A38</td>
<td class="instruction">STA $60</td>
</tr>
<tr>
<td class="address-1"><span id="2A3A"></span>$2A3A</td>
<td class="instruction">JSR <a href="3279.html">$3279</a></td>
<td class="comment-1" rowspan="1">Copy the current character's buffer into page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="2A3D"></span>$2A3D</td>
<td class="instruction">LDA $56</td>
<td class="comment-1" rowspan="2">Restore the carry flag from bit 0 at <a href="004D.html#0056">$56</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2A3F"></span>$2A3F</td>
<td class="instruction">ROR A</td>
</tr>
<tr>
<td class="address-1"><span id="2A40"></span>$2A40</td>
<td class="instruction">LDA $57</td>
<td class="comment-1" rowspan="1">Pick up the victim's character number (or 0) from <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="2A42"></span>$2A42</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="298B.html">$298B</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29C8">Map</a></td>
<td class="next">
Next: <a href="2A43.html">$2A43</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.3 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>