<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $1A04</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="19A5.html">$19A5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1A04">Map</a></td>
<td class="next">
Next: <a href="1A50.html">$1A50</a>
</td>
</tr>
</table>
<div class="description">$1A04: Make a character walk up and down until a certain time</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This corresponds to <a href="https://skoolkid.github.io/skooldaze/asm/62D7.html">$62D7</a> in the ZX Spectrum version.
</div>
<div class="paragraph">
Used by command lists <a href="40DC.html">$88</a>, <a href="40E7.html">$8C</a>, <a href="40FA.html">$8E</a>, <a href="410D.html">$90</a>, <a href="4118.html">$92</a>, <a href="4123.html">$94</a>, <a href="413D.html">$96</a>, <a href="4150.html">$98</a>, <a href="415B.html">$9A</a>, <a href="4166.html">$9C</a>, <a href="4180.html">$9E</a>, <a href="4193.html">$A0</a>, <a href="419E.html">$A2</a>, <a href="41A9.html">$A4</a>, <a href="41C3.html">$A6</a>, <a href="41D6.html">$A8</a>, <a href="41E1.html">$AA</a>, <a href="41E8.html">$AC</a>, <a href="41F7.html">$AE</a>, <a href="4206.html">$B0</a>, <a href="420D.html">$B2</a>, <a href="421C.html">$B4</a>, <a href="4247.html">$BA</a>, <a href="424E.html">$BC</a>, <a href="4298.html">$C6</a>, <a href="429F.html">$C8</a>, <a href="42A6.html">$CA</a>, <a href="42CF.html">$CE</a>, <a href="42E3.html">$D0</a>, <a href="42FB.html">$D2</a>, <a href="4309.html">$D4</a>, <a href="431F.html">$D6</a>, <a href="4334.html">$D8</a>, <a href="4352.html">$DA</a>, <a href="4376.html">$DE</a> and <a href="438A.html">$E0</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="1A04"></span>$1A04</td>
<td class="instruction">LDA $3F</td>
<td class="comment-1" rowspan="3">Reset bit 1 of the flags byte at <a href="003F.html">$3F</a>: the character is not running continuously.</td>
</tr>
<tr>
<td class="address-1"><span id="1A06"></span>$1A06</td>
<td class="instruction">AND #$FC</td>
</tr>
<tr>
<td class="address-1"><span id="1A08"></span>$1A08</td>
<td class="instruction">STA $3F</td>
</tr>
<tr>
<td class="address-1"><span id="1A0A"></span>$1A0A</td>
<td class="instruction">JSR <a href="3BE7.html">$3BE7</a></td>
<td class="comment-1" rowspan="2">Collect the event identifier from the command list and store it at <a href="00A6.html">$A6</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1A0D"></span>$1A0D</td>
<td class="instruction">STA $A6</td>
</tr>
<tr>
<td class="address-1"><span id="1A0F"></span>$1A0F</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="2">Copy the character's current x-coordinate to <a href="00A6.html#00A7">$A7</a>. This will be the walkabout origin x-coordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="1A11"></span>$1A11</td>
<td class="instruction">STA $A7</td>
</tr>
<tr>
<td class="address-1"><span id="1A13"></span>$1A13</td>
<td class="instruction">LDA #$1A</td>
<td class="comment-1" rowspan="4">Replace the address of this primary command routine in the character's buffer with that of <a href="1A04.html#1A1B">$1A1B</a> below.</td>
</tr>
<tr>
<td class="address-1"><span id="1A15"></span>$1A15</td>
<td class="instruction">STA $2A</td>
</tr>
<tr>
<td class="address-1"><span id="1A17"></span>$1A17</td>
<td class="instruction">LDA #$1B</td>
</tr>
<tr>
<td class="address-1"><span id="1A19"></span>$1A19</td>
<td class="instruction">STA $29</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1A1B"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="27AB.html">$27AB</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="1A1B"></span>$1A1B</td>
<td class="instruction">LDA $A6</td>
<td class="comment-1" rowspan="1">Pick up the walkabout event identifier from <a href="00A6.html">$A6</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1A1D"></span>$1A1D</td>
<td class="instruction">JSR <a href="31D2.html">$31D2</a></td>
<td class="comment-1" rowspan="1">Has the signal for this event been raised?</td>
</tr>
<tr>
<td class="address-1"><span id="1A20"></span>$1A20</td>
<td class="instruction">BCC <a href="1A04.html#1A37">$1A37</a></td>
<td class="comment-1" rowspan="1">Branch if not to begin another mini-walkabout.</td>
</tr>
<tr>
<td class="address-1"><span id="1A22"></span>$1A22</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="1">Pick up the character's x-coordinate from <a href="00FB.html#00FC">$FC</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1A24"></span>$1A24</td>
<td class="instruction">CMP $A7</td>
<td class="comment-1" rowspan="1">Is the character at the walkabout origin?</td>
</tr>
<tr>
<td class="address-1"><span id="1A26"></span>$1A26</td>
<td class="instruction">BNE <a href="1A04.html#1A30">$1A30</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="1A28"></span>$1A28</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="1">Pick up the character's animatory state from <a href="0026.html">$26</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1A2A"></span>$1A2A</td>
<td class="instruction">LSR A</td>
<td class="comment-1" rowspan="1">Is the character midstride?</td>
</tr>
<tr>
<td class="address-1"><span id="1A2B"></span>$1A2B</td>
<td class="instruction">BCS <a href="1A04.html#1A30">$1A30</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="1A2D"></span>$1A2D</td>
<td class="instruction">JMP <a href="1D2D.html">$1D2D</a></td>
<td class="comment-1" rowspan="1">Otherwise terminate this primary command.</td>
</tr>
<tr>
<td class="address-2"><span id="1A30"></span>$1A30</td>
<td class="instruction">LDA $A7</td>
<td class="comment-1" rowspan="2">Pick up the walkabout origin x-coordinate from <a href="00A6.html#00A7">$A7</a> and copy it to <a href="00AC.html">$AC</a>, making it the next mini-walkabout destination.</td>
</tr>
<tr>
<td class="address-1"><span id="1A32"></span>$1A32</td>
<td class="instruction">STA $AC</td>
</tr>
<tr>
<td class="address-1"><span id="1A34"></span>$1A34</td>
<td class="instruction">JMP <a href="1A04.html#1A45">$1A45</a></td>
<td class="comment-1" rowspan="1">Jump forward.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="1A37"></span>
<div class="comments">
<div class="paragraph">
The signal has not been raised yet, so it's time for another mini-walkabout.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="1A37"></span>$1A37</td>
<td class="instruction">LDA $D41B</td>
<td class="comment-1" rowspan="3">Generate a random value between 0 and 7 and store it at <a href="004D.html#0057">$57</a> temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="1A3A"></span>$1A3A</td>
<td class="instruction">AND #$07</td>
</tr>
<tr>
<td class="address-1"><span id="1A3C"></span>$1A3C</td>
<td class="instruction">STA $57</td>
</tr>
<tr>
<td class="address-1"><span id="1A3E"></span>$1A3E</td>
<td class="instruction">LDA $A7</td>
<td class="comment-1" rowspan="1">Pick up the walkabout origin x-coordinate from <a href="00A6.html#00A7">$A7</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1A40"></span>$1A40</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="3">Subtract the random value between 0 and 7 and store the result at <a href="00AC.html">$AC</a>. This will be the walkabout destination x-coordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="1A41"></span>$1A41</td>
<td class="instruction">SBC $57</td>
</tr>
<tr>
<td class="address-1"><span id="1A43"></span>$1A43</td>
<td class="instruction">STA $AC</td>
</tr>
<tr>
<td class="address-2"><span id="1A45"></span>$1A45</td>
<td class="instruction">LDA #$13</td>
<td class="comment-1" rowspan="4">Place the address of the interruptible subcommand routine at <a href="136F.html">$136F</a> into the character's buffer.</td>
</tr>
<tr>
<td class="address-1"><span id="1A47"></span>$1A47</td>
<td class="instruction">STA $AB</td>
</tr>
<tr>
<td class="address-1"><span id="1A49"></span>$1A49</td>
<td class="instruction">LDA #$6F</td>
</tr>
<tr>
<td class="address-1"><span id="1A4B"></span>$1A4B</td>
<td class="instruction">STA $AA</td>
</tr>
<tr>
<td class="address-1"><span id="1A4D"></span>$1A4D</td>
<td class="instruction">JMP (<a href="00AA.html">$00AA</a>)</td>
<td class="comment-1" rowspan="1">Jump to <a href="136F.html">$136F</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="19A5.html">$19A5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1A04">Map</a></td>
<td class="next">
Next: <a href="1A50.html">$1A50</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>