<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $189D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="184E.html">$184E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#189D">Map</a></td>
<td class="next">
Next: <a href="191B.html">$191B</a>
</td>
</tr>
</table>
<div class="description">$189D: Deal with ERIC when he's jumping</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This corresponds to <a href="https://skoolkid.github.io/skooldaze/asm/F533.html">$F533</a> in the ZX Spectrum version.
</div>
<div class="paragraph">
Used by the routine at <a href="15B3.html">$15B3</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="189D"></span>$189D</td>
<td class="instruction">DEC $FE</td>
<td class="comment-1" rowspan="1">Decrement ERIC's action timer at <a href="00FE.html">$FE</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="189F"></span>$189F</td>
<td class="instruction">BNE <a href="189D.html#18A4">$18A4</a></td>
<td class="comment-1" rowspan="1">Branch unless it's zero.</td>
</tr>
<tr>
<td class="address-1"><span id="18A1"></span>$18A1</td>
<td class="instruction">JMP <a href="191B.html#191F">$191F</a></td>
<td class="comment-1" rowspan="1">Make ERIC finish the jump.</td>
</tr>
<tr>
<td class="address-2"><span id="18A4"></span>$18A4</td>
<td class="instruction">LDA $FE</td>
<td class="comment-1" rowspan="1">Pick up ERIC's action timer from <a href="00FE.html">$FE</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="18A6"></span>$18A6</td>
<td class="instruction">CMP #$0D</td>
<td class="comment-1" rowspan="1">Is ERIC's action timer now $0D?</td>
</tr>
<tr>
<td class="address-1"><span id="18A8"></span>$18A8</td>
<td class="instruction">BNE <a href="189D.html#18AD">$18AD</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18AA"></span>$18AA</td>
<td class="instruction">JMP <a href="176F.html">$176F</a></td>
<td class="comment-1" rowspan="1">Check whether ERIC has jumped up to the safe or a shield.</td>
</tr>
<tr>
<td class="address-2"><span id="18AD"></span>$18AD</td>
<td class="instruction">CMP #$0C</td>
<td class="comment-1" rowspan="1">Is it time to give ERIC lines for jumping?</td>
</tr>
<tr>
<td class="address-1"><span id="18AF"></span>$18AF</td>
<td class="instruction">BNE <a href="189D.html#18B6">$18B6</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18B1"></span>$18B1</td>
<td class="instruction">LDA #$0F</td>
<td class="comment-1" rowspan="1">Lines reprimand <a href="4CE0.html">$0F</a>: YOU ARE NOT A KANGAROO.</td>
</tr>
<tr>
<td class="address-1"><span id="18B3"></span>$18B3</td>
<td class="instruction">JMP <a href="191B.html#1972">$1972</a></td>
<td class="comment-1" rowspan="1">Make any nearby teacher give ERIC lines.</td>
</tr>
<tr>
<td class="address-2"><span id="18B6"></span>$18B6</td>
<td class="instruction">CMP #$0E</td>
<td class="comment-1" rowspan="1">Is it time to make the jumping sound effect?</td>
</tr>
<tr>
<td class="address-1"><span id="18B8"></span>$18B8</td>
<td class="instruction">BNE <a href="189D.html#18C5">$18C5</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18BA"></span>$18BA</td>
<td class="instruction">LDA #$02</td>
<td class="comment-1" rowspan="2">Set the sound effect identifier at <a href="002C.html">$2C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="18BC"></span>$18BC</td>
<td class="instruction">STA $2C</td>
</tr>
<tr>
<td class="address-1"><span id="18BE"></span>$18BE</td>
<td class="instruction">LDA #$21</td>
<td class="comment-1" rowspan="2">Initialise the sound effect timer at <a href="002D.html">$2D</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="18C0"></span>$18C0</td>
<td class="instruction">STA $2D</td>
</tr>
<tr>
<td class="address-1"><span id="18C2"></span>$18C2</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="18C5"></span>$18C5</td>
<td class="instruction">CMP #$09</td>
<td class="comment-1" rowspan="1">Is it time to move ERIC's arm back?</td>
</tr>
<tr>
<td class="address-1"><span id="18C7"></span>$18C7</td>
<td class="instruction">BNE <a href="189D.html#18CC">$18CC</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18C9"></span>$18C9</td>
<td class="instruction">JMP <a href="2B9F.html#2BA7">$2BA7</a></td>
<td class="comment-1" rowspan="1">Decrement ERIC's animatory state and return.</td>
</tr>
<tr>
<td class="address-2"><span id="18CC"></span>$18CC</td>
<td class="instruction">CMP #$03</td>
<td class="comment-1" rowspan="1">Is it time to bring ERIC back down to the floor?</td>
</tr>
<tr>
<td class="address-1"><span id="18CE"></span>$18CE</td>
<td class="instruction">BNE <a href="189D.html#18DB">$18DB</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18D0"></span>$18D0</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the ERIC's current animatory state and location.</td>
</tr>
<tr>
<td class="address-1"><span id="18D3"></span>$18D3</td>
<td class="instruction">INC $FB</td>
<td class="comment-1" rowspan="1">Increment ERIC's y-coordinate, bringing him back to the floor.</td>
</tr>
<tr>
<td class="address-1"><span id="18D5"></span>$18D5</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's new location.</td>
</tr>
<tr>
<td class="address-1"><span id="18D8"></span>$18D8</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="18DB"></span>$18DB</td>
<td class="instruction">CMP #$86</td>
<td class="comment-1" rowspan="1">Is ERIC's action timer equal to $86 now?</td>
</tr>
<tr>
<td class="address-1"><span id="18DD"></span>$18DD</td>
<td class="instruction">BNE <a href="189D.html#18E2">$18E2</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18DF"></span>$18DF</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="18E2"></span>$18E2</td>
<td class="instruction">CMP #$80</td>
<td class="comment-1" rowspan="1">Is ERIC's action timer equal to $80 now (meaning ERIC has landed after jumping on a boy)?</td>
</tr>
<tr>
<td class="address-1"><span id="18E4"></span>$18E4</td>
<td class="instruction">BNE <a href="189D.html#18ED">$18ED</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="18E6"></span>$18E6</td>
<td class="instruction">LDA #$07</td>
<td class="comment-1" rowspan="2">Set ERIC's action timer at <a href="00FE.html">$FE</a> to 7.</td>
</tr>
<tr>
<td class="address-1"><span id="18E8"></span>$18E8</td>
<td class="instruction">STA $FE</td>
</tr>
<tr>
<td class="address-1"><span id="18EA"></span>$18EA</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="18ED"></span>$18ED</td>
<td class="instruction">CMP #$81</td>
<td class="comment-1" rowspan="1">Is ERIC's action timer less than $80 (we know it's not equal to $80)? (This instruction is redundant.)</td>
</tr>
<tr>
<td class="address-1"><span id="18EF"></span>$18EF</td>
<td class="instruction">BCC <a href="189D.html#18F7">$18F7</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="18F1"></span>$18F1</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="2">ERIC jumped while standing on a boy, so subtract $80 from his action timer value before performing the usual checks.</td>
</tr>
<tr>
<td class="address-1"><span id="18F2"></span>$18F2</td>
<td class="instruction">SBC #$80</td>
</tr>
<tr>
<td class="address-1"><span id="18F4"></span>$18F4</td>
<td class="instruction">JMP <a href="189D.html#18A6">$18A6</a></td>
<td class="comment-1" rowspan="1">Jump back.</td>
</tr>
<tr>
<td class="address-2"><span id="18F7"></span>$18F7</td>
<td class="instruction">CMP #$06</td>
<td class="comment-1" rowspan="1">Is it time to check whether ERIC has jumped while standing on a boy?</td>
</tr>
<tr>
<td class="address-1"><span id="18F9"></span>$18F9</td>
<td class="instruction">BEQ <a href="189D.html#18FE">$18FE</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="18FB"></span>$18FB</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Otherwise return.</td>
</tr>
<tr>
<td class="address-2"><span id="18FE"></span>$18FE</td>
<td class="instruction">LDA $4C</td>
<td class="comment-1" rowspan="1">Pick up the keyboard/joystick reading from <a href="004C.html">$4C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1900"></span>$1900</td>
<td class="instruction">PHA</td>
<td class="comment-1" rowspan="1">Save it temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="1901"></span>$1901</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="2">Reset the keyboard/joystick reading at <a href="004C.html">$4C</a> to zero.</td>
</tr>
<tr>
<td class="address-1"><span id="1903"></span>$1903</td>
<td class="instruction">STA $4C</td>
</tr>
<tr>
<td class="address-1"><span id="1905"></span>$1905</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="1">Restore the keyboard/joystick reading to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="1906"></span>$1906</td>
<td class="instruction">CMP #$4A</td>
<td class="comment-1" rowspan="1">Was 'J' (jump) pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="1908"></span>$1908</td>
<td class="instruction">BEQ <a href="189D.html#1911">$1911</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="190A"></span>$190A</td>
<td class="instruction">CMP #$4C</td>
<td class="comment-1" rowspan="1">Was 'L' (jump) pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="190C"></span>$190C</td>
<td class="instruction">BEQ <a href="189D.html#1911">$1911</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="190E"></span>$190E</td>
<td class="instruction">JMP <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Otherwise return.</td>
</tr>
<tr>
<td class="address-2"><span id="1911"></span>$1911</td>
<td class="instruction">JSR <a href="1640.html">$1640</a></td>
<td class="comment-1" rowspan="1">Is ERIC is standing on a boy?</td>
</tr>
<tr>
<td class="address-1"><span id="1914"></span>$1914</td>
<td class="instruction">BCC <a href="189D.html#191A">$191A</a></td>
<td class="comment-1" rowspan="1">Return if not.</td>
</tr>
<tr>
<td class="address-1"><span id="1916"></span>$1916</td>
<td class="instruction">LDA #$90</td>
<td class="comment-1" rowspan="2">Set the action timer for ERIC at <a href="00FE.html">$FE</a> to $90. It will remain at $80 or more until the jump above the boy has finished.</td>
</tr>
<tr>
<td class="address-1"><span id="1918"></span>$1918</td>
<td class="instruction">STA $FE</td>
</tr>
<tr>
<td class="address-2"><span id="191A"></span>$191A</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="184E.html">$184E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#189D">Map</a></td>
<td class="next">
Next: <a href="191B.html">$191B</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>