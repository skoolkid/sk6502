<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $3687</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="365C.html">$365C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#3687">Map</a></td>
<td class="next">
Next: <a href="36E3.html">$36E3</a>
</td>
</tr>
</table>
<div class="description">$3687: 'S' pressed - sit/stand</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This corresponds to <a href="https://skoolkid.github.io/skooldaze/asm/6CAF.html">$6CAF</a> in the ZX Spectrum version.
</div>
<div class="paragraph">
Called from the main loop at <a href="0800.html">$0800</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="3687"></span>$3687</td>
<td class="instruction">LDA #$1A</td>
<td class="comment-1" rowspan="2">Set voice #3 attack length to 8ms and decay length to 1.5s.</td>
</tr>
<tr>
<td class="address-1"><span id="3689"></span>$3689</td>
<td class="instruction">STA $D413</td>
</tr>
<tr>
<td class="address-1"><span id="368C"></span>$368C</td>
<td class="instruction">LDA #$81</td>
<td class="comment-1" rowspan="2">Set voice #3 control register: voice on, attack-decay-sustain cycle; noise enabled.</td>
</tr>
<tr>
<td class="address-1"><span id="368E"></span>$368E</td>
<td class="instruction">STA $D412</td>
</tr>
<tr>
<td class="address-1"><span id="3691"></span>$3691</td>
<td class="instruction">LDA $14</td>
<td class="comment-1" rowspan="3">Flip the bits in ERIC's posture indicator at <a href="0014.html">$14</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="3693"></span>$3693</td>
<td class="instruction">EOR #$FF</td>
</tr>
<tr>
<td class="address-1"><span id="3695"></span>$3695</td>
<td class="instruction">STA $14</td>
</tr>
<tr>
<td class="address-1"><span id="3697"></span>$3697</td>
<td class="instruction">BNE <a href="3687.html#36D6">$36D6</a></td>
<td class="comment-1" rowspan="1">Branch if ERIC is standing up now.</td>
</tr>
<tr>
<td class="address-1"><span id="3699"></span>$3699</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current animatory state and location.</td>
</tr>
<tr>
<td class="address-1"><span id="369C"></span>$369C</td>
<td class="instruction">JSR <a href="1C8E.html">$1C8E</a></td>
<td class="comment-1" rowspan="1">Is ERIC on a staircase?</td>
</tr>
<tr>
<td class="address-1"><span id="369F"></span>$369F</td>
<td class="instruction">BCC <a href="3687.html#36B6">$36B6</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="36A1"></span>$36A1</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="1">Pick up ERIC's x-coordinate from <a href="00FB.html#00FC">$FC</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="36A3"></span>$36A3</td>
<td class="instruction">CMP #$30</td>
<td class="comment-1" rowspan="1">Is ERIC on s staircase on the right side of the skool?</td>
</tr>
<tr>
<td class="address-1"><span id="36A5"></span>$36A5</td>
<td class="instruction">BCS <a href="3687.html#36AC">$36AC</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="36A7"></span>$36A7</td>
<td class="instruction">LDA #$85</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#05">$85</a> is the animatory state of ERIC sitting (as on a staircase) facing right.</td>
</tr>
<tr>
<td class="address-1"><span id="36A9"></span>$36A9</td>
<td class="instruction">JMP <a href="3687.html#36AE">$36AE</a></td>
<td class="comment-1" rowspan="1">Jump forward.</td>
</tr>
<tr>
<td class="address-2"><span id="36AC"></span>$36AC</td>
<td class="instruction">LDA #$05</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#05">$05</a> is the animatory state of ERIC sitting (as on a staircase) facing left.</td>
</tr>
<tr>
<td class="address-2"><span id="36AE"></span>$36AE</td>
<td class="instruction">STA $26</td>
<td class="comment-1" rowspan="1">Update ERIC's animatory state at <a href="0026.html">$26</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="36B0"></span>$36B0</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's new animatory state.</td>
</tr>
<tr>
<td class="address-1"><span id="36B3"></span>$36B3</td>
<td class="instruction">JMP <a href="3687.html#36E2">$36E2</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="36B6"></span>$36B6</td>
<td class="instruction">LDA $12</td>
<td class="comment-1" rowspan="1">Pick up ERIC's location indicator from <a href="0012.html">$12</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="36B8"></span>$36B8</td>
<td class="instruction">BEQ <a href="3687.html#36C7">$36C7</a></td>
<td class="comment-1" rowspan="1">Branch if ERIC's on the bottom floor.</td>
</tr>
<tr>
<td class="address-1"><span id="36BA"></span>$36BA</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="1">Pick up ERIC's animatory state from <a href="0026.html">$26</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="36BC"></span>$36BC</td>
<td class="instruction">ASL A</td>
<td class="comment-1" rowspan="1">Is ERIC facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="36BD"></span>$36BD</td>
<td class="instruction">BCS <a href="3687.html#36C7">$36C7</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="36BF"></span>$36BF</td>
<td class="instruction">JSR <a href="1A51.html">$1A51</a></td>
<td class="comment-1" rowspan="1">Is ERIC beside a chair?</td>
</tr>
<tr>
<td class="address-1"><span id="36C2"></span>$36C2</td>
<td class="instruction">BNE <a href="3687.html#36C7">$36C7</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="36C4"></span>$36C4</td>
<td class="instruction">JMP <a href="1C59.html">$1C59</a></td>
<td class="comment-1" rowspan="1">Sit ERIC in the chair, knocking any current occupant to the floor.</td>
</tr>
<tr>
<td class="address-2"><span id="36C7"></span>$36C7</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="5">Set ERIC's animatory state at <a href="0026.html">$26</a> to <a href="../graphics/as.html#06">$06/$86</a> to make him sit on the floor.</td>
</tr>
<tr>
<td class="address-1"><span id="36C9"></span>$36C9</td>
<td class="instruction">AND #$80</td>
</tr>
<tr>
<td class="address-1"><span id="36CB"></span>$36CB</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="36CC"></span>$36CC</td>
<td class="instruction">ADC #$06</td>
</tr>
<tr>
<td class="address-1"><span id="36CE"></span>$36CE</td>
<td class="instruction">STA $26</td>
</tr>
<tr>
<td class="address-1"><span id="36D0"></span>$36D0</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's new animatory state.</td>
</tr>
<tr>
<td class="address-1"><span id="36D3"></span>$36D3</td>
<td class="instruction">JMP <a href="3687.html#36E2">$36E2</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="36D6"></span>$36D6</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current animatory state and location.</td>
</tr>
<tr>
<td class="address-1"><span id="36D9"></span>$36D9</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="3">Set ERIC's animatory state at <a href="0026.html">$26</a> to <a href="../graphics/as.html#00">$00/$80</a> to make him stand up.</td>
</tr>
<tr>
<td class="address-1"><span id="36DB"></span>$36DB</td>
<td class="instruction">AND #$80</td>
</tr>
<tr>
<td class="address-1"><span id="36DD"></span>$36DD</td>
<td class="instruction">STA $26</td>
</tr>
<tr>
<td class="address-1"><span id="36DF"></span>$36DF</td>
<td class="instruction">JSR <a href="322E.html">$322E</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's new animatory state.</td>
</tr>
<tr>
<td class="address-2"><span id="36E2"></span>$36E2</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="365C.html">$365C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#3687">Map</a></td>
<td class="next">
Next: <a href="36E3.html">$36E3</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>