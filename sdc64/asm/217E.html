<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $217E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="217D.html">$217D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#217E">Map</a></td>
<td class="next">
Next: <a href="2241.html">$2241</a>
</td>
</tr>
</table>
<div class="description">$217E: Generate the character codes of the digits of a number</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="2241.html">$2241</a>, <a href="2500.html">$2500</a> and <a href="2620.html">$2620</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">(<a href="00A2.html#00A3">$A3,$A4</a>)</td>
<td class="register-desc">The number</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="217E"></span>$217E</td>
<td class="instruction">LDA #$20</td>
<td class="comment-1" rowspan="6">Prepare 5 space characters at <a href="0084.html#008A">$8A-$8E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2180"></span>$2180</td>
<td class="instruction">STA $8A</td>
</tr>
<tr>
<td class="address-1"><span id="2182"></span>$2182</td>
<td class="instruction">STA $8B</td>
</tr>
<tr>
<td class="address-1"><span id="2184"></span>$2184</td>
<td class="instruction">STA $8C</td>
</tr>
<tr>
<td class="address-1"><span id="2186"></span>$2186</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="2188"></span>$2188</td>
<td class="instruction">STA $8E</td>
</tr>
<tr>
<td class="address-1"><span id="218A"></span>$218A</td>
<td class="instruction">LDA $A4</td>
<td class="comment-1" rowspan="1">Pick up the MSB of the number.</td>
</tr>
<tr>
<td class="address-2"><span id="218C"></span>$218C</td>
<td class="instruction">CMP #$28</td>
<td class="comment-1" rowspan="1">Is it less than 40 (meaning the number is less than 10240)?</td>
</tr>
<tr>
<td class="address-1"><span id="218E"></span>$218E</td>
<td class="instruction">BCC <a href="217E.html#21B6">$21B6</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-2"><span id="2190"></span>$2190</td>
<td class="instruction">LDA $8A</td>
<td class="comment-1" rowspan="5">Increment the character code of the first digit at <a href="0084.html#008A">$8A</a> from space to '1', '1' to '2' etc.</td>
</tr>
<tr>
<td class="address-1"><span id="2192"></span>$2192</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="2193"></span>$2193</td>
<td class="instruction">ADC #$01</td>
</tr>
<tr>
<td class="address-1"><span id="2195"></span>$2195</td>
<td class="instruction">ORA #$10</td>
</tr>
<tr>
<td class="address-1"><span id="2197"></span>$2197</td>
<td class="instruction">STA $8A</td>
</tr>
<tr>
<td class="address-1"><span id="2199"></span>$2199</td>
<td class="instruction">LDA #$30</td>
<td class="comment-1" rowspan="4">Set the character code of the second, third and fourth digits at <a href="0084.html#008B">$8B</a>, <a href="0084.html#008C">$8C</a> and <a href="0084.html#008D">$8D</a> to '0'.</td>
</tr>
<tr>
<td class="address-1"><span id="219B"></span>$219B</td>
<td class="instruction">STA $8B</td>
</tr>
<tr>
<td class="address-1"><span id="219D"></span>$219D</td>
<td class="instruction">STA $8C</td>
</tr>
<tr>
<td class="address-1"><span id="219F"></span>$219F</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="21A1"></span>$21A1</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="10">Subtract $2774 (10100) from the number at <a href="00A2.html#00A3">$A3</a>. (This is a <a href="../reference/bugs.html#mistrialSubtraction">bug</a>.)</td>
</tr>
<tr>
<td class="address-1"><span id="21A3"></span>$21A3</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="21A4"></span>$21A4</td>
<td class="instruction">SBC #$74</td>
</tr>
<tr>
<td class="address-1"><span id="21A6"></span>$21A6</td>
<td class="instruction">STA $A3</td>
</tr>
<tr>
<td class="address-1"><span id="21A8"></span>$21A8</td>
<td class="instruction">BCS <a href="217E.html#21AC">$21AC</a></td>
</tr>
<tr>
<td class="address-1"><span id="21AA"></span>$21AA</td>
<td class="instruction">DEC $A4</td>
</tr>
<tr>
<td class="address-2"><span id="21AC"></span>$21AC</td>
<td class="instruction">LDA $A4</td>
</tr>
<tr>
<td class="address-1"><span id="21AE"></span>$21AE</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="21AF"></span>$21AF</td>
<td class="instruction">SBC #$27</td>
</tr>
<tr>
<td class="address-1"><span id="21B1"></span>$21B1</td>
<td class="instruction">STA $A4</td>
</tr>
<tr>
<td class="address-1"><span id="21B3"></span>$21B3</td>
<td class="instruction">JMP <a href="217E.html#218C">$218C</a></td>
<td class="comment-1" rowspan="1">Jump back to consider the 10000's digit again.</td>
</tr>
<tr>
<td class="address-2"><span id="21B6"></span>$21B6</td>
<td class="instruction">CMP #$27</td>
<td class="comment-1" rowspan="1">Is the MSB of the number 39 (meaning the number is at least 9984)?</td>
</tr>
<tr>
<td class="address-1"><span id="21B8"></span>$21B8</td>
<td class="instruction">BNE <a href="217E.html#21C0">$21C0</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="21BA"></span>$21BA</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="1">Pick up the LSB of the number.</td>
</tr>
<tr>
<td class="address-1"><span id="21BC"></span>$21BC</td>
<td class="instruction">CMP #$74</td>
<td class="comment-1" rowspan="1">Is it 116 or more (meaning the number is 10100 or more)? (This is a <a href="../reference/bugs.html#mistrialSubtraction">bug</a>.)</td>
</tr>
<tr>
<td class="address-1"><span id="21BE"></span>$21BE</td>
<td class="instruction">BCS <a href="217E.html#2190">$2190</a></td>
<td class="comment-1" rowspan="1">Branch back to deal with the 10000s digit if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="21C0"></span>
<div class="comments">
<div class="paragraph">
The 10000s digit has been computed. Now for the 1000s digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="21C0"></span>$21C0</td>
<td class="instruction">LDA $A4</td>
<td class="comment-1" rowspan="1">Pick up the MSB of what remains of the number.</td>
</tr>
<tr>
<td class="address-2"><span id="21C2"></span>$21C2</td>
<td class="instruction">CMP #$04</td>
<td class="comment-1" rowspan="1">Is it less than 4 (meaning the number is less than 1024)?</td>
</tr>
<tr>
<td class="address-1"><span id="21C4"></span>$21C4</td>
<td class="instruction">BCC <a href="217E.html#21EA">$21EA</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-2"><span id="21C6"></span>$21C6</td>
<td class="instruction">LDA $8B</td>
<td class="comment-1" rowspan="5">Increment the character code of the second digit at <a href="0084.html#008B">$8B</a> from space or '0' to '1', '1' to '2' etc.</td>
</tr>
<tr>
<td class="address-1"><span id="21C8"></span>$21C8</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="21C9"></span>$21C9</td>
<td class="instruction">ADC #$01</td>
</tr>
<tr>
<td class="address-1"><span id="21CB"></span>$21CB</td>
<td class="instruction">ORA #$10</td>
</tr>
<tr>
<td class="address-1"><span id="21CD"></span>$21CD</td>
<td class="instruction">STA $8B</td>
</tr>
<tr>
<td class="address-1"><span id="21CF"></span>$21CF</td>
<td class="instruction">LDA #$30</td>
<td class="comment-1" rowspan="3">Set the character code of the third and fourth digits at <a href="0084.html#008C">$8C</a> and <a href="0084.html#008D">$8D</a> to '0'.</td>
</tr>
<tr>
<td class="address-1"><span id="21D1"></span>$21D1</td>
<td class="instruction">STA $8C</td>
</tr>
<tr>
<td class="address-1"><span id="21D3"></span>$21D3</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="21D5"></span>$21D5</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="10">Subtract $03E8 (1000) from the number at <a href="00A2.html#00A3">$A3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="21D7"></span>$21D7</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="21D8"></span>$21D8</td>
<td class="instruction">SBC #$E8</td>
</tr>
<tr>
<td class="address-1"><span id="21DA"></span>$21DA</td>
<td class="instruction">STA $A3</td>
</tr>
<tr>
<td class="address-1"><span id="21DC"></span>$21DC</td>
<td class="instruction">BCS <a href="217E.html#21E0">$21E0</a></td>
</tr>
<tr>
<td class="address-1"><span id="21DE"></span>$21DE</td>
<td class="instruction">DEC $A4</td>
</tr>
<tr>
<td class="address-2"><span id="21E0"></span>$21E0</td>
<td class="instruction">LDA $A4</td>
</tr>
<tr>
<td class="address-1"><span id="21E2"></span>$21E2</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="21E3"></span>$21E3</td>
<td class="instruction">SBC #$03</td>
</tr>
<tr>
<td class="address-1"><span id="21E5"></span>$21E5</td>
<td class="instruction">STA $A4</td>
</tr>
<tr>
<td class="address-1"><span id="21E7"></span>$21E7</td>
<td class="instruction">JMP <a href="217E.html#21C2">$21C2</a></td>
<td class="comment-1" rowspan="1">Jump back to consider the 1000s digit again.</td>
</tr>
<tr>
<td class="address-2"><span id="21EA"></span>$21EA</td>
<td class="instruction">CMP #$03</td>
<td class="comment-1" rowspan="1">Is the MSB of the number 3 (meaning the number is at least 768)?</td>
</tr>
<tr>
<td class="address-1"><span id="21EC"></span>$21EC</td>
<td class="instruction">BNE <a href="217E.html#21F4">$21F4</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="21EE"></span>$21EE</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="1">Pick up the LSB of the number.</td>
</tr>
<tr>
<td class="address-1"><span id="21F0"></span>$21F0</td>
<td class="instruction">CMP #$E8</td>
<td class="comment-1" rowspan="1">Is it 232 or more (meaning the number is 1000 or more)?</td>
</tr>
<tr>
<td class="address-1"><span id="21F2"></span>$21F2</td>
<td class="instruction">BCS <a href="217E.html#21C6">$21C6</a></td>
<td class="comment-1" rowspan="1">Branch back to deal with the 1000s digit if so.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="21F4"></span>
<div class="comments">
<div class="paragraph">
The 1000s digit has been computed. Now for the 100s digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="21F4"></span>$21F4</td>
<td class="instruction">LDA $A4</td>
<td class="comment-1" rowspan="1">Pick up the MSB of what remains of the number.</td>
</tr>
<tr>
<td class="address-1"><span id="21F6"></span>$21F6</td>
<td class="instruction">BEQ <a href="217E.html#2213">$2213</a></td>
<td class="comment-1" rowspan="1">Branch if it's zero (meaning the number is less than 256).</td>
</tr>
<tr>
<td class="address-2"><span id="21F8"></span>$21F8</td>
<td class="instruction">LDA $8C</td>
<td class="comment-1" rowspan="5">Increment the character code of the third digit at <a href="0084.html#008C">$8C</a> from space or '0' to '1', '1' to '2' etc.</td>
</tr>
<tr>
<td class="address-1"><span id="21FA"></span>$21FA</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="21FB"></span>$21FB</td>
<td class="instruction">ADC #$01</td>
</tr>
<tr>
<td class="address-1"><span id="21FD"></span>$21FD</td>
<td class="instruction">ORA #$10</td>
</tr>
<tr>
<td class="address-1"><span id="21FF"></span>$21FF</td>
<td class="instruction">STA $8C</td>
</tr>
<tr>
<td class="address-1"><span id="2201"></span>$2201</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="6">Subtract $64 (100) from the number at <a href="00A2.html#00A3">$A3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2203"></span>$2203</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="2204"></span>$2204</td>
<td class="instruction">SBC #$64</td>
</tr>
<tr>
<td class="address-1"><span id="2206"></span>$2206</td>
<td class="instruction">STA $A3</td>
</tr>
<tr>
<td class="address-1"><span id="2208"></span>$2208</td>
<td class="instruction">BCS <a href="217E.html#220C">$220C</a></td>
</tr>
<tr>
<td class="address-1"><span id="220A"></span>$220A</td>
<td class="instruction">DEC $A4</td>
</tr>
<tr>
<td class="address-2"><span id="220C"></span>$220C</td>
<td class="instruction">LDA #$30</td>
<td class="comment-1" rowspan="2">Set the character code of the fourth digit at <a href="0084.html#008D">$8D</a> to '0'.</td>
</tr>
<tr>
<td class="address-1"><span id="220E"></span>$220E</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="2210"></span>$2210</td>
<td class="instruction">JMP <a href="217E.html#21F4">$21F4</a></td>
<td class="comment-1" rowspan="1">Jump back to consider the 100s digit again.</td>
</tr>
<tr>
<td class="address-2"><span id="2213"></span>$2213</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="1">Pick up the LSB of the number.</td>
</tr>
<tr>
<td class="address-1"><span id="2215"></span>$2215</td>
<td class="instruction">CMP #$64</td>
<td class="comment-1" rowspan="1">Is it 100 or more?</td>
</tr>
<tr>
<td class="address-1"><span id="2217"></span>$2217</td>
<td class="instruction">BCS <a href="217E.html#21F8">$21F8</a></td>
<td class="comment-1" rowspan="1">Branch back to deal with the 100s digit if so.</td>
</tr>
<tr>
<td class="address-1"><span id="2219"></span>$2219</td>
<td class="instruction">JMP <a href="217E.html#2222">$2222</a></td>
<td class="comment-1" rowspan="1">Otherwise jump forward to compute the 10s digit.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="221C"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="1DB7.html">$1DB7</a> (to generate the character codes of the first two digits of a lines amount) and <a href="2241.html">$2241</a> (to generate the character codes of the digits in a number used in a question asked by MR WACKER).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="221C"></span>$221C</td>
<td class="instruction">LDA #$20</td>
<td class="comment-1" rowspan="3">Set the character codes of the last two digits at <a href="0084.html#008D">$8D</a> and <a href="0084.html#008E">$8E</a> to 32 (space).</td>
</tr>
<tr>
<td class="address-1"><span id="221E"></span>$221E</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="2220"></span>$2220</td>
<td class="instruction">STA $8E</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="2222"></span>
<div class="comments">
<div class="paragraph">
The 100s digit has been computed. Now for the 10s digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="2222"></span>$2222</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="1">Pick up the LSB of what remains of the number.</td>
</tr>
<tr>
<td class="address-1"><span id="2224"></span>$2224</td>
<td class="instruction">CMP #$0A</td>
<td class="comment-1" rowspan="1">Is it less than 10?</td>
</tr>
<tr>
<td class="address-1"><span id="2226"></span>$2226</td>
<td class="instruction">BCC <a href="217E.html#223B">$223B</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="2228"></span>$2228</td>
<td class="instruction">LDA $8D</td>
<td class="comment-1" rowspan="5">Increment the character code of the fourth digit at <a href="0084.html#008D">$8D</a> from space or '0' to '1', '1' to '2' etc.</td>
</tr>
<tr>
<td class="address-1"><span id="222A"></span>$222A</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="222B"></span>$222B</td>
<td class="instruction">ADC #$01</td>
</tr>
<tr>
<td class="address-1"><span id="222D"></span>$222D</td>
<td class="instruction">ORA #$10</td>
</tr>
<tr>
<td class="address-1"><span id="222F"></span>$222F</td>
<td class="instruction">STA $8D</td>
</tr>
<tr>
<td class="address-1"><span id="2231"></span>$2231</td>
<td class="instruction">LDA $A3</td>
<td class="comment-1" rowspan="4">Subtract 10 from the number at <a href="00A2.html#00A3">$A3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="2233"></span>$2233</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="2234"></span>$2234</td>
<td class="instruction">SBC #$0A</td>
</tr>
<tr>
<td class="address-1"><span id="2236"></span>$2236</td>
<td class="instruction">STA $A3</td>
</tr>
<tr>
<td class="address-1"><span id="2238"></span>$2238</td>
<td class="instruction">JMP <a href="217E.html#2222">$2222</a></td>
<td class="comment-1" rowspan="1">Jump back to consider the 10s digit again.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="223B"></span>
<div class="comments">
<div class="paragraph">
The 10s digit has been computed. Now for the 1s digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="223B"></span>$223B</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="3">Add 48 to the remaining value to get the character code of the final digit, and store it at <a href="0084.html#008E">$8E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="223C"></span>$223C</td>
<td class="instruction">ADC #$30</td>
</tr>
<tr>
<td class="address-1"><span id="223E"></span>$223E</td>
<td class="instruction">STA $8E</td>
</tr>
<tr>
<td class="address-1"><span id="2240"></span>$2240</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="217D.html">$217D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#217E">Map</a></td>
<td class="next">
Next: <a href="2241.html">$2241</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>