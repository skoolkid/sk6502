<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $1640</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="15B3.html">$15B3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1640">Map</a></td>
<td class="next">
Next: <a href="169B.html">$169B</a>
</td>
</tr>
</table>
<div class="description">$1640: Check whether ERIC is standing on a boy</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="189D.html">$189D</a>.
</div>
</div>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">P</td>
<td class="register-desc">Carry flag set if ERIC is standing on a boy</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="1640"></span>$1640</td>
<td class="instruction">LDA #$0B</td>
<td class="comment-1" rowspan="1">There are 11 little boys.</td>
</tr>
<tr>
<td class="address-1"><span id="1642"></span>$1642</td>
<td class="instruction">STA $57</td>
<td class="comment-1" rowspan="1">Store this counter at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1644"></span>$1644</td>
<td class="instruction">LDA $FB</td>
<td class="comment-1" rowspan="3">Pick up ERIC's y-coordinate from <a href="00FB.html">$FB</a>, store a copy at <a href="00D3.html#00D4">$D4</a> and increment it. If ERIC is standing on a boy, this would be the boy's y-coordinate.</td>
</tr>
<tr>
<td class="address-1"><span id="1646"></span>$1646</td>
<td class="instruction">STA $D4</td>
</tr>
<tr>
<td class="address-1"><span id="1648"></span>$1648</td>
<td class="instruction">INC $D4</td>
</tr>
<tr>
<td class="address-1"><span id="164A"></span>$164A</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="2">Pick up ERIC's x-coordinate from <a href="00FB.html#00FC">$FC</a> and store a copy at <a href="00D3.html">$D3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="164C"></span>$164C</td>
<td class="instruction">STA $D3</td>
</tr>
<tr>
<td class="address-1"><span id="164E"></span>$164E</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="2">Set the current character number at <a href="0060.html">$60</a> to $00 (little boy no. 1).</td>
</tr>
<tr>
<td class="address-1"><span id="1650"></span>$1650</td>
<td class="instruction">STA $60</td>
</tr>
<tr>
<td class="address-1"><span id="1652"></span>$1652</td>
<td class="instruction">JSR <a href="1640.html#1662">$1662</a></td>
<td class="comment-1" rowspan="1">Is ERIC standing on any of the little boys?</td>
</tr>
<tr>
<td class="address-1"><span id="1655"></span>$1655</td>
<td class="instruction">BCC <a href="1640.html#165A">$165A</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="1657"></span>$1657</td>
<td class="instruction">JMP <a href="1640.html#169A">$169A</a></td>
<td class="comment-1" rowspan="1">Otherwise return with the carry flag set.</td>
</tr>
<tr>
<td class="address-2"><span id="165A"></span>$165A</td>
<td class="instruction">LDA #$03</td>
<td class="comment-1" rowspan="1">There are three main kids besides ERIC: ANGELFACE, BOY WONDER and EINSTEIN.</td>
</tr>
<tr>
<td class="address-1"><span id="165C"></span>$165C</td>
<td class="instruction">STA $57</td>
<td class="comment-1" rowspan="1">Store this counter at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="165E"></span>$165E</td>
<td class="instruction">LDA #$0F</td>
<td class="comment-1" rowspan="2">Set the current character number at <a href="0060.html">$60</a> to $0F (ANGELFACE).</td>
</tr>
<tr>
<td class="address-1"><span id="1660"></span>$1660</td>
<td class="instruction">STA $60</td>
</tr>
<tr>
<td class="address-2"><span id="1662"></span>$1662</td>
<td class="instruction">JSR <a href="3279.html">$3279</a></td>
<td class="comment-1" rowspan="1">Copy the current character's buffer to page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="1665"></span>$1665</td>
<td class="instruction">LDA $D4</td>
<td class="comment-1" rowspan="1">Pick up the y-coordinate from <a href="00D3.html#00D4">$D4</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1667"></span>$1667</td>
<td class="instruction">CMP $FB</td>
<td class="comment-1" rowspan="1">Does it match the character's y-coordinate?</td>
</tr>
<tr>
<td class="address-1"><span id="1669"></span>$1669</td>
<td class="instruction">BNE <a href="1640.html#168E">$168E</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="166B"></span>$166B</td>
<td class="instruction">DEC $D3</td>
<td class="comment-1" rowspan="1">Decrement the x-coordinate at <a href="00D3.html">$D3</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="166D"></span>$166D</td>
<td class="instruction">LDA $FC</td>
<td class="comment-1" rowspan="1">Pick up the character's x-coordinate from <a href="00FB.html#00FC">$FC</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="166F"></span>$166F</td>
<td class="instruction">CMP $D3</td>
<td class="comment-1" rowspan="1">Is the character's x-coordinate smaller?</td>
</tr>
<tr>
<td class="address-1"><span id="1671"></span>$1671</td>
<td class="instruction">BCC <a href="1640.html#168E">$168E</a></td>
<td class="comment-1" rowspan="1">Branch if so (without restoring the x-coordinate at <a href="00D3.html">$D3</a> to its original value, which is a <a href="../reference/bugs.html#leapsOfFaith">bug</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="1673"></span>$1673</td>
<td class="instruction">INC $D3</td>
<td class="comment-1" rowspan="3">Add two to the x-coordinate at <a href="00D3.html">$D3</a> and pick up its new value.</td>
</tr>
<tr>
<td class="address-1"><span id="1675"></span>$1675</td>
<td class="instruction">INC $D3</td>
</tr>
<tr>
<td class="address-1"><span id="1677"></span>$1677</td>
<td class="instruction">LDA $D3</td>
</tr>
<tr>
<td class="address-1"><span id="1679"></span>$1679</td>
<td class="instruction">CMP $FC</td>
<td class="comment-1" rowspan="1">Is the character's x-coordinate greater?</td>
</tr>
<tr>
<td class="address-1"><span id="167B"></span>$167B</td>
<td class="instruction">BCC <a href="1640.html#168E">$168E</a></td>
<td class="comment-1" rowspan="1">Branch if so (without restoring the x-coordinate at <a href="00D3.html">$D3</a> to its original value, which is a <a href="../reference/bugs.html#leapsOfFaith">bug</a>).</td>
</tr>
<tr>
<td class="address-1"><span id="167D"></span>$167D</td>
<td class="instruction">LDA $26</td>
<td class="comment-1" rowspan="1">Pick up the boy's animatory state from <a href="0026.html">$26</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="167F"></span>$167F</td>
<td class="instruction">AND #$0F</td>
<td class="comment-1" rowspan="1">Keep only bits 0-3.</td>
</tr>
<tr>
<td class="address-1"><span id="1681"></span>$1681</td>
<td class="instruction">CMP #$07</td>
<td class="comment-1" rowspan="1">Is the boy lying flat on his back?</td>
</tr>
<tr>
<td class="address-1"><span id="1683"></span>$1683</td>
<td class="instruction">BNE <a href="1640.html#168E">$168E</a></td>
<td class="comment-1" rowspan="1">Branch if not.</td>
</tr>
<tr>
<td class="address-1"><span id="1685"></span>$1685</td>
<td class="instruction">LDA #$14</td>
<td class="comment-1" rowspan="1">Character number $14 is ERIC.</td>
</tr>
<tr>
<td class="address-1"><span id="1687"></span>$1687</td>
<td class="instruction">JSR <a href="3279.html">$3279</a></td>
<td class="comment-1" rowspan="1">Copy ERIC's character buffer into page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="168A"></span>$168A</td>
<td class="instruction">SEC</td>
<td class="comment-1" rowspan="1">Set the carry flag: ERIC is standing on a boy.</td>
</tr>
<tr>
<td class="address-1"><span id="168B"></span>$168B</td>
<td class="instruction">JMP <a href="1640.html#169A">$169A</a></td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="168E"></span>$168E</td>
<td class="instruction">INC $60</td>
<td class="comment-1" rowspan="1">Increment the current character number at <a href="0060.html">$60</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1690"></span>$1690</td>
<td class="instruction">DEC $57</td>
<td class="comment-1" rowspan="1">Decrement the character counter at <a href="004D.html#0057">$57</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="1692"></span>$1692</td>
<td class="instruction">BNE <a href="1640.html#1662">$1662</a></td>
<td class="comment-1" rowspan="1">Branch back to check any remaining boys.</td>
</tr>
<tr>
<td class="address-1"><span id="1694"></span>$1694</td>
<td class="instruction">LDA #$14</td>
<td class="comment-1" rowspan="1">Character number $14 is ERIC.</td>
</tr>
<tr>
<td class="address-1"><span id="1696"></span>$1696</td>
<td class="instruction">JSR <a href="3279.html">$3279</a></td>
<td class="comment-1" rowspan="1">Copy ERIC's character buffer into page 0.</td>
</tr>
<tr>
<td class="address-1"><span id="1699"></span>$1699</td>
<td class="instruction">CLC</td>
<td class="comment-1" rowspan="1">Clear the carry flag: ERIC is not standing on a boy.</td>
</tr>
<tr>
<td class="address-2"><span id="169A"></span>$169A</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="15B3.html">$15B3</a>
</td>
<td class="up">Up: <a href="../maps/all.html#1640">Map</a></td>
<td class="next">
Next: <a href="169B.html">$169B</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>