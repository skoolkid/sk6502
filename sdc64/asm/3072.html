<!DOCTYPE html>
<html>
<head>
<title>Skool Daze: Routine at $3072</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../theme.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="3047.html">$3047</a>
</td>
<td class="up">Up: <a href="../maps/all.html#3072">Map</a></td>
<td class="next">
Next: <a href="3113.html">$3113</a>
</td>
</tr>
</table>
<div class="description">$3072: Shift the play area window left</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="35EF.html">$35EF</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="3072"></span>$3072</td>
<td class="instruction">SEI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="address-1"><span id="3073"></span>$3073</td>
<td class="instruction">LDA $58</td>
<td class="comment-1" rowspan="1">Pick up the x-coordinate of the leftmost column of the skool on screen from <a href="0058.html">$58</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="3075"></span>$3075</td>
<td class="instruction">CMP #$08</td>
<td class="comment-1" rowspan="1">Is it 8 or more?</td>
</tr>
<tr>
<td class="address-1"><span id="3077"></span>$3077</td>
<td class="instruction">BCS <a href="3072.html#307C">$307C</a></td>
<td class="comment-1" rowspan="1">Branch if so.</td>
</tr>
<tr>
<td class="address-1"><span id="3079"></span>$3079</td>
<td class="instruction">JMP <a href="3072.html#3111">$3111</a></td>
<td class="comment-1" rowspan="1">Otherwise return now.</td>
</tr>
<tr>
<td class="address-2"><span id="307C"></span>$307C</td>
<td class="instruction">LDA #$08</td>
<td class="comment-1" rowspan="2">Set the destination colour information index at <a href="004D.html#0055">$55</a> to 8.</td>
</tr>
<tr>
<td class="address-1"><span id="307E"></span>$307E</td>
<td class="instruction">STA $55</td>
</tr>
<tr>
<td class="address-1"><span id="3080"></span>$3080</td>
<td class="instruction">LDA #$00</td>
<td class="comment-1" rowspan="2">Set the source colour information index at <a href="004D.html#0054">$54</a> to 0.</td>
</tr>
<tr>
<td class="address-1"><span id="3082"></span>$3082</td>
<td class="instruction">STA $54</td>
</tr>
<tr>
<td class="address-1"><span id="3084"></span>$3084</td>
<td class="instruction">LDA #$F8</td>
<td class="comment-1" rowspan="4">Store $E0F8 at <a href="005A.html">$5A</a>. This screen bitmap address corresponds to the 32nd tile from the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="3086"></span>$3086</td>
<td class="instruction">STA $5A</td>
</tr>
<tr>
<td class="address-1"><span id="3088"></span>$3088</td>
<td class="instruction">LDA #$E0</td>
</tr>
<tr>
<td class="address-1"><span id="308A"></span>$308A</td>
<td class="instruction">STA $5B</td>
</tr>
<tr>
<td class="address-1"><span id="308C"></span>$308C</td>
<td class="instruction">LDA #$1F</td>
<td class="comment-1" rowspan="4">Store $CC1F at <a href="005A.html#005C">$5C</a>. This colour information address corresponds to the 32nd tile from the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="308E"></span>$308E</td>
<td class="instruction">STA $5C</td>
</tr>
<tr>
<td class="address-1"><span id="3090"></span>$3090</td>
<td class="instruction">LDA #$CC</td>
</tr>
<tr>
<td class="address-1"><span id="3092"></span>$3092</td>
<td class="instruction">STA $5D</td>
</tr>
<tr>
<td class="address-1"><span id="3094"></span>$3094</td>
<td class="instruction">LDX #$20</td>
<td class="comment-1" rowspan="1">Initialise the column counter in <span class="register">X</span>.</td>
</tr>
<tr>
<td class="address-2"><span id="3096"></span>$3096</td>
<td class="instruction">DEX</td>
<td class="comment-1" rowspan="1">Decrement the column counter in <span class="register">X</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="3097"></span>$3097</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="2">Save the column counter on the stack temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="3098"></span>$3098</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="3099"></span>$3099</td>
<td class="instruction">LDA $5A</td>
<td class="comment-1" rowspan="4">Copy the screen bitmap address from <a href="005A.html">$5A</a> to <a href="004D.html#004E">$4E</a>. This will be the source address.</td>
</tr>
<tr>
<td class="address-1"><span id="309B"></span>$309B</td>
<td class="instruction">STA $4E</td>
</tr>
<tr>
<td class="address-1"><span id="309D"></span>$309D</td>
<td class="instruction">LDA $5B</td>
</tr>
<tr>
<td class="address-1"><span id="309F"></span>$309F</td>
<td class="instruction">STA $4F</td>
</tr>
<tr>
<td class="address-1"><span id="30A1"></span>$30A1</td>
<td class="instruction">LDA $5C</td>
<td class="comment-1" rowspan="4">Copy the colour information address from <a href="005A.html#005C">$5C</a> to <a href="004D.html#0050">$50</a>. This will be the source address.</td>
</tr>
<tr>
<td class="address-1"><span id="30A3"></span>$30A3</td>
<td class="instruction">STA $50</td>
</tr>
<tr>
<td class="address-1"><span id="30A5"></span>$30A5</td>
<td class="instruction">LDA $5D</td>
</tr>
<tr>
<td class="address-1"><span id="30A7"></span>$30A7</td>
<td class="instruction">STA $51</td>
</tr>
<tr>
<td class="address-1"><span id="30A9"></span>$30A9</td>
<td class="instruction">LDA $4E</td>
<td class="comment-1" rowspan="4">Copy the screen bitmap address from <a href="004D.html#004E">$4E</a> to <a href="004D.html#0052">$52</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="30AB"></span>$30AB</td>
<td class="instruction">STA $52</td>
</tr>
<tr>
<td class="address-1"><span id="30AD"></span>$30AD</td>
<td class="instruction">LDA $4F</td>
</tr>
<tr>
<td class="address-1"><span id="30AF"></span>$30AF</td>
<td class="instruction">STA $53</td>
</tr>
<tr>
<td class="address-1"><span id="30B1"></span>$30B1</td>
<td class="instruction">LDA $52</td>
<td class="comment-1" rowspan="6">Add 64 to the screen bitmap address at <a href="004D.html#0052">$52</a>. This corresponds to the tile that is 8 cells to the right in the same row, and will be the destination address.</td>
</tr>
<tr>
<td class="address-1"><span id="30B3"></span>$30B3</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="30B4"></span>$30B4</td>
<td class="instruction">ADC #$40</td>
</tr>
<tr>
<td class="address-1"><span id="30B6"></span>$30B6</td>
<td class="instruction">BCC <a href="3072.html#30BA">$30BA</a></td>
</tr>
<tr>
<td class="address-1"><span id="30B8"></span>$30B8</td>
<td class="instruction">INC $53</td>
</tr>
<tr>
<td class="address-2"><span id="30BA"></span>$30BA</td>
<td class="instruction">STA $52</td>
</tr>
<tr>
<td class="address-1"><span id="30BC"></span>$30BC</td>
<td class="instruction">JSR <a href="2FB6.html">$2FB6</a></td>
<td class="comment-1" rowspan="1">Move a column of screen tiles right.</td>
</tr>
<tr>
<td class="address-1"><span id="30BF"></span>$30BF</td>
<td class="instruction">LDA $5A</td>
<td class="comment-1" rowspan="7">Subtract 8 from the screen bitmap address at <a href="005A.html">$5A</a>. This corresponds to the next tile to the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30C1"></span>$30C1</td>
<td class="instruction">CLC</td>
</tr>
<tr>
<td class="address-1"><span id="30C2"></span>$30C2</td>
<td class="instruction">ADC #$F8</td>
</tr>
<tr>
<td class="address-1"><span id="30C4"></span>$30C4</td>
<td class="instruction">CMP #$F8</td>
</tr>
<tr>
<td class="address-1"><span id="30C6"></span>$30C6</td>
<td class="instruction">BNE <a href="3072.html#30CA">$30CA</a></td>
</tr>
<tr>
<td class="address-1"><span id="30C8"></span>$30C8</td>
<td class="instruction">DEC $5B</td>
</tr>
<tr>
<td class="address-2"><span id="30CA"></span>$30CA</td>
<td class="instruction">STA $5A</td>
</tr>
<tr>
<td class="address-1"><span id="30CC"></span>$30CC</td>
<td class="instruction">DEC $5C</td>
<td class="comment-1" rowspan="1">Subtract 1 from the colour information address at <a href="005A.html#005C">$5C</a>. This corresponds to the next tile to the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30CE"></span>$30CE</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="2">Restore the column counter to <span class="register">X</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="30CF"></span>$30CF</td>
<td class="instruction">TAX</td>
</tr>
<tr>
<td class="address-1"><span id="30D0"></span>$30D0</td>
<td class="instruction">BNE <a href="3072.html#3096">$3096</a></td>
<td class="comment-1" rowspan="1">Branch back to deal with the remaining columns.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30D2"></span>
<div class="comments">
<div class="paragraph">
The 32 leftmost columns of the skool on screen have been shifted right. Time to draw the leftmost 8 columns of the skool.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="30D2"></span>$30D2</td>
<td class="instruction">LDA #$38</td>
<td class="comment-1" rowspan="4">Store $E038 at <a href="005A.html">$5A</a>. This screen bitmap address corresponds to the 8th tile from the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30D4"></span>$30D4</td>
<td class="instruction">STA $5A</td>
</tr>
<tr>
<td class="address-1"><span id="30D6"></span>$30D6</td>
<td class="instruction">LDA #$E0</td>
</tr>
<tr>
<td class="address-1"><span id="30D8"></span>$30D8</td>
<td class="instruction">STA $5B</td>
</tr>
<tr>
<td class="address-1"><span id="30DA"></span>$30DA</td>
<td class="instruction">LDA #$07</td>
<td class="comment-1" rowspan="2">Update the colour information address at <a href="005A.html#005C">$5C</a> to $CC07. This corresponds to the 8th tile from the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30DC"></span>$30DC</td>
<td class="instruction">STA $5C</td>
</tr>
<tr>
<td class="address-1"><span id="30DE"></span>$30DE</td>
<td class="instruction">JSR <a href="9868.html">$9868</a></td>
<td class="comment-1" rowspan="1">Move sprites #1-#6 right by 64 pixels.</td>
</tr>
<tr>
<td class="address-1"><span id="30E1"></span>$30E1</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30E2"></span>$30E2</td>
<td class="instruction">LDX #$08</td>
<td class="comment-1" rowspan="1">There are 8 new play area columns to draw in the gap left by the shifting window.</td>
</tr>
<tr>
<td class="address-2"><span id="30E4"></span>$30E4</td>
<td class="instruction">TXA</td>
<td class="comment-1" rowspan="2">Save this column counter temporarily.</td>
</tr>
<tr>
<td class="address-1"><span id="30E5"></span>$30E5</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="30E6"></span>$30E6</td>
<td class="instruction">DEC $58</td>
<td class="comment-1" rowspan="2">Decrement the x-coordinates of the leftmost column of the skool on screen and off.</td>
</tr>
<tr>
<td class="address-1"><span id="30E8"></span>$30E8</td>
<td class="instruction">DEC $59</td>
</tr>
<tr>
<td class="address-1"><span id="30EA"></span>$30EA</td>
<td class="instruction">LDY $58</td>
<td class="comment-1" rowspan="1">Pick up the x-coordinate of the leftmost column of the skool on screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30EC"></span>$30EC</td>
<td class="instruction">LDA $5A</td>
<td class="comment-1" rowspan="4">Save the screen bitmap address on the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30EE"></span>$30EE</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="30EF"></span>$30EF</td>
<td class="instruction">LDA $5B</td>
</tr>
<tr>
<td class="address-1"><span id="30F1"></span>$30F1</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="30F2"></span>$30F2</td>
<td class="instruction">LDA $5C</td>
<td class="comment-1" rowspan="4">Save the colour information address on the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30F4"></span>$30F4</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="30F5"></span>$30F5</td>
<td class="instruction">LDA $5D</td>
</tr>
<tr>
<td class="address-1"><span id="30F7"></span>$30F7</td>
<td class="instruction">PHA</td>
</tr>
<tr>
<td class="address-1"><span id="30F8"></span>$30F8</td>
<td class="instruction">JSR <a href="2F8C.html">$2F8C</a></td>
<td class="comment-1" rowspan="1">Print the play area tiles in a single column of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30FB"></span>$30FB</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="4">Restore the saved colour information address to <a href="005A.html#005C">$5C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="30FC"></span>$30FC</td>
<td class="instruction">STA $5D</td>
</tr>
<tr>
<td class="address-1"><span id="30FE"></span>$30FE</td>
<td class="instruction">PLA</td>
</tr>
<tr>
<td class="address-1"><span id="30FF"></span>$30FF</td>
<td class="instruction">STA $5C</td>
</tr>
<tr>
<td class="address-1"><span id="3101"></span>$3101</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="6">Restore the saved screen bitmap address to <a href="005A.html">$5A</a> and subtract 8 from it. This points at the next tile to the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="3102"></span>$3102</td>
<td class="instruction">STA $5B</td>
</tr>
<tr>
<td class="address-1"><span id="3104"></span>$3104</td>
<td class="instruction">PLA</td>
</tr>
<tr>
<td class="address-1"><span id="3105"></span>$3105</td>
<td class="instruction">SEC</td>
</tr>
<tr>
<td class="address-1"><span id="3106"></span>$3106</td>
<td class="instruction">SBC #$08</td>
</tr>
<tr>
<td class="address-1"><span id="3108"></span>$3108</td>
<td class="instruction">STA $5A</td>
</tr>
<tr>
<td class="address-1"><span id="310A"></span>$310A</td>
<td class="instruction">DEC $5C</td>
<td class="comment-1" rowspan="1">Subtract 1 from the colour information address at <a href="005A.html#005C">$5C</a>. This points at the next tile to the left in the top row of the screen.</td>
</tr>
<tr>
<td class="address-1"><span id="310C"></span>$310C</td>
<td class="instruction">PLA</td>
<td class="comment-1" rowspan="2">Restore the column counter to <span class="register">X</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="310D"></span>$310D</td>
<td class="instruction">TAX</td>
</tr>
<tr>
<td class="address-1"><span id="310E"></span>$310E</td>
<td class="instruction">DEX</td>
<td class="comment-1" rowspan="1">Decrement the column counter.</td>
</tr>
<tr>
<td class="address-1"><span id="310F"></span>$310F</td>
<td class="instruction">BNE <a href="3072.html#30E4">$30E4</a></td>
<td class="comment-1" rowspan="1">Branch back to deal with the remaining columns.</td>
</tr>
<tr>
<td class="address-2"><span id="3111"></span>$3111</td>
<td class="instruction">CLI</td>
<td class="comment-1" rowspan="1">Re-enable interrupts.</td>
</tr>
<tr>
<td class="address-1"><span id="3112"></span>$3112</td>
<td class="instruction">RTS</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="3047.html">$3047</a>
</td>
<td class="up">Up: <a href="../maps/all.html#3072">Map</a></td>
<td class="next">
Next: <a href="3113.html">$3113</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Skool Daze C64 disassembly 20210325</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2021 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4 and <a href="https://github.com/skoolkid/sk6502">sk6502</a>.</div>
</footer>
</body>
</html>